<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png"><link rel="mask-icon" href="/images/logo.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=EB Garamond:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"brookliu.xyz",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"./public/search.xml"}</script><meta name="description" content="组件化和逻辑复用能帮助写出简洁易懂的代码，随着应用越写越复杂，我们有必要把视图层中重复的逻辑抽成组件，以求在多个页面中复用；同时对于 Vuex 端，Store 中的逻辑也会越来越臃肿，我们有必要使用 Vuex 提供的 Getters 来复用本地数据获取逻辑。在这篇教程中，我们将带领你抽出 Vue 组件简化页面逻辑，使用 Vuex Getters 复用本地数据获取逻辑。"><meta property="og:type" content="article"><meta property="og:title" content="从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（四）"><meta property="og:url" content="https://brookliu.xyz/2020/01/30/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89/index.html"><meta property="og:site_name" content="1024肥宅"><meta property="og:description" content="组件化和逻辑复用能帮助写出简洁易懂的代码，随着应用越写越复杂，我们有必要把视图层中重复的逻辑抽成组件，以求在多个页面中复用；同时对于 Vuex 端，Store 中的逻辑也会越来越臃肿，我们有必要使用 Vuex 提供的 Getters 来复用本地数据获取逻辑。在这篇教程中，我们将带领你抽出 Vue 组件简化页面逻辑，使用 Vuex Getters 复用本地数据获取逻辑。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-01-30T08:55:27.000Z"><meta property="article:modified_time" content="2020-11-17T07:39:39.084Z"><meta property="article:author" content="Brookliu"><meta property="article:tag" content="Node"><meta property="article:tag" content="Express"><meta property="article:tag" content="Vue"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://brookliu.xyz/2020/01/30/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（四） | 1024肥宅</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="1024肥宅" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a href="https://github.com/liubrook" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">1024肥宅</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签<span class="badge">25</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类<span class="badge">19</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档<span class="badge">92</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/liubrook" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://brookliu.xyz/2020/01/30/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/logo.png"><meta itemprop="name" content="Brookliu"><meta itemprop="description" content="扶我起来，我还能写"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="1024肥宅"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（四）</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-01-30 16:55:27" itemprop="dateCreated datePublished" datetime="2020-01-30T16:55:27+08:00">2020-01-30</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-11-17 15:39:39" itemprop="dateModified" datetime="2020-11-17T15:39:39+08:00">2020-11-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Vue/" itemprop="url" rel="index"><span itemprop="name">Vue</span></a></span></span><span id="/2020/01/30/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（四）" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/2020/01/30/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/01/30/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>组件化和逻辑复用能帮助写出简洁易懂的代码，随着应用越写越复杂，我们有必要把视图层中重复的逻辑抽成组件，以求在多个页面中复用；同时对于 Vuex 端，Store 中的逻辑也会越来越臃肿，我们有必要使用 Vuex 提供的 Getters 来复用本地数据获取逻辑。在这篇教程中，我们将带领你抽出 Vue 组件简化页面逻辑，使用 Vuex Getters 复用本地数据获取逻辑。</p><a id="more"></a><h2 id="使用-Vue-组件简化页面逻辑"><a href="#使用-Vue-组件简化页面逻辑" class="headerlink" title="使用 Vue 组件简化页面逻辑"></a>使用 Vue 组件简化页面逻辑</h2><p><a href="https://tuture.co/2020/02/11/6f96d15/" target="_blank" rel="noopener">原文地址</a></p><p>在前面的教程中，我们已经学习了如何使用 Vuex 进行状态管理，如何使用 Action 获取远程数据以及如何使用 Mutation 修改本地状态，实现了用户修改客户端数据的同时，同步更新后端数据，然后更新本地数据，最后进行重新渲染。</p><p>这一节我们将进一步通过 Vue 组件化的思想简化复杂的页面逻辑。</p><p>如果你之前没有在<a href="https://brookliu.xyz/2020/01/20/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/#more">第二篇教程</a>中测试过，很有可能你的数据库是空的，那么可以下载我们提供的 MongoDB JSON 数据文件：</p><p><a href="https://raw.githubusercontent.com/tuture-dev/vue-online-shop-backend/master/data/manufacturers.json" target="_blank" rel="noopener">manufacturers.json</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// manufacturers.json</span></span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b192dfe031505deaf62"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"Apple Inc"</span>,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b252dfe031505deaf63"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"华为"</span>,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b2d2dfe031505deaf64"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"小米"</span>,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b352dfe031505deaf65"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"Vivo"</span>,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b402dfe031505deaf66"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"OPPO"</span>,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure><p><a href="https://raw.githubusercontent.com/tuture-dev/vue-online-shop-backend/master/data/products.json" target="_blank" rel="noopener">products.json</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// products.json</span></span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194c1b2dfe031505deaf67"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"iPhone"</span>,<span class="attr">"description"</span>:<span class="string">"iPhone是美国苹果公司研发的智能手机系列，搭载苹果公司研发的iOS操作系统"</span>,<span class="attr">"image"</span>:<span class="string">"https://i.gadgets360cdn.com/large/iPhone11_leak_1567592422045.jpg"</span>,<span class="attr">"price"</span>:<span class="number">2000</span>,<span class="attr">"manufacturer"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b192dfe031505deaf62"</span>&#125;,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194c532dfe031505deaf68"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"荣耀20"</span>,<span class="attr">"description"</span>:<span class="string">"李现同款 4800万超广角AI四摄 3200W美颜自拍 麒麟Kirin980全网通版8GB+128GB 蓝水翡翠 全面屏手机"</span>,<span class="attr">"image"</span>:<span class="string">"https://article-fd.zol-img.com.cn/t_s640x2000/g4/M08/0E/0E/ChMlzF2myueILMN_AAGSPzoz23wAAYJ3QADttsAAZJX090.jpg"</span>,<span class="attr">"price"</span>:<span class="number">2499</span>,<span class="attr">"manufacturer"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b252dfe031505deaf63"</span>&#125;,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194c762dfe031505deaf69"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"MIX2S"</span>,<span class="attr">"description"</span>:<span class="string">"骁龙845 全面屏NFC 游戏智能拍照手机 白色 全网通 6+128"</span>,<span class="attr">"image"</span>:<span class="string">"http://himg2.huanqiu.com/attachment2010/2018/0129/08/39/20180129083933823.jpg"</span>,<span class="attr">"price"</span>:<span class="number">1688</span>,<span class="attr">"manufacturer"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b2d2dfe031505deaf64"</span>&#125;,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194cc42dfe031505deaf6a"</span>&#125;,<span class="attr">"name"</span>:<span class="string">"Reno2"</span>,<span class="attr">"description"</span>:<span class="string">"【12期免息1年碎屏险】4800万变焦四摄8+128G防抖6.5英寸全面屏新 深海夜光(8GB+128GB) 官方标配"</span>,<span class="attr">"image"</span>:<span class="string">"https://news.maxabout.com/wp-content/uploads/2019/08/OPPO-Reno-2-1.jpg"</span>,<span class="attr">"price"</span>:<span class="number">2999</span>,<span class="attr">"manufacturer"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"5e194b402dfe031505deaf66"</span>&#125;,<span class="attr">"__v"</span>:<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure><p>然后运行以下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongoimport -d test -c manufacturers manufacturers.json</span><br><span class="line">mongoimport -d test -c products products.json</span><br></pre></td></tr></table></figure><h3 id="实现-ProductButton-组件"><a href="#实现-ProductButton-组件" class="headerlink" title="实现 ProductButton 组件"></a>实现 ProductButton 组件</h3><p>我们打开 <code>src/components/products/ProductButton.vue</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;components&#x2F;products&#x2F;ProductButton.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button v-if&#x3D;&quot;isAdding&quot; @click&#x3D;&quot;addToCart&quot; class&#x3D;&quot;button&quot;&gt;加入购物车&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;button v-else @click&#x3D;&quot;removeFromCart(product._id)&quot; class&#x3D;&quot;button&quot;&gt;从购物车移除&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [&#39;product&#39;],</span><br><span class="line">  computed: &#123;</span><br><span class="line">    isAdding () &#123;</span><br><span class="line">      let isAdding &#x3D; true</span><br><span class="line">      this.cart.map(product &#x3D;&gt; &#123;</span><br><span class="line">        if (product._id &#x3D;&#x3D;&#x3D; this.product._id) &#123;</span><br><span class="line">          isAdding &#x3D; false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      return isAdding</span><br><span class="line">    &#125;,</span><br><span class="line">    cart() &#123;</span><br><span class="line">      return this.$store.state.cart</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addToCart() &#123;</span><br><span class="line">      this.$store.commit(&#39;ADD_TO_CART&#39;, &#123;</span><br><span class="line">        product: this.product</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    removeFromCart (productId) &#123;</span><br><span class="line">      this.$store.commit(&#39;REMOVE_FROM_CART&#39;, &#123;</span><br><span class="line">        productId</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>该组件通过 <code>v-if</code> 判断 <code>isAdding</code> 是否为 <code>true</code> 来决定创建加入购物车按钮还是从购物车移除按钮。<code>cart</code> 数组是通过 <code>this.$store.state.cart</code> 从本地获取的。在 <code>isAdding</code> 中我们先令其为 <code>true</code>，然后通过 <code>cart</code> 数组的 <code>map</code> 方法遍历数组，判断当前商品是否在购物车中，如果不在则 <code>isAdding</code> 为 <code>true</code>，创建加入购物车按钮；如果在则 <code>isAdding</code> 为 <code>false</code>，创建从购物车移除按钮。<br>对应的两个按钮添加了两个点击事件：<code>addToCart</code> 和 <code>removeFromCart</code></p><ul><li>当点击加入购物车按钮时触发 addToCart，我们通过 this.$store.commit 的方式将包含当前商品的对象作为载荷直接提交到类型为 ADD_TO_CART 的 mutation 中，将该商品添加到本地购物车中。</li><li>当点击从购物车移除按钮时触发 removeFromCart，我们也是通过 this.$store.commit 的方式将包含当前商品 id 的对象作为载荷直接提交到类型为 REMOVE_FROM_CART 的 mutation 中，将该商品从本地购物车中移除。</li></ul><h3 id="实现-ProductItem-组件"><a href="#实现-ProductItem-组件" class="headerlink" title="实现 ProductItem 组件"></a>实现 ProductItem 组件</h3><p><code>src/components/products/ProductItem.vue</code> 文件为商品信息组件，用来展示商品详细信息，并且注册了上面讲的按钮组件，改变商品在购物车中的状态，除此之外我们还使用了之前创建好的 <code>ProductButton</code> 组件，实现对商品在购物车中的状态进行修改。</p><ul><li>首先通过 <code>import ProductButton from &#39;./ProductButton&#39;</code> 导入创建好的 <code>ProductButton</code> 组件。</li><li>然后在 <code>components</code> 中注册组件。</li><li>最后在模板中使用该组件。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;components&#x2F;products&#x2F;ProductItem.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;product&quot;&gt;</span><br><span class="line">      &lt;p class&#x3D;&quot;product_name&quot;&gt;产品名称：&#123;&#123;product.name&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;p class&#x3D;&quot;product_description&quot;&gt;介绍：&#123;&#123;product.description&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;p class&#x3D;&quot;product_price&quot;&gt;价格：&#123;&#123;product.price&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;p class&#x3D;&quot;product_manufacturer&quot;&gt;生产厂商：&#123;&#123;product.manufacturer.name&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;img :src&#x3D;&quot;product.image&quot; alt&#x3D;&quot;&quot; class&#x3D;&quot;product_image&quot;&gt;</span><br><span class="line">      &lt;product-button :product&#x3D;&quot;product&quot;&gt;&lt;&#x2F;product-button&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ProductButton from &#39;.&#x2F;ProductButton.vue&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;product-item&#39;,</span><br><span class="line">  props: [&#39;product&#39;],</span><br><span class="line">  components: &#123;</span><br><span class="line">    &#39;product-button&#39;: ProductButton</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>可以看到，我们将父组件传入的 <code>product</code>对象展示到模板中，并将该 <code>product</code> 对象传到子组件 <code>ProductButton</code> 中。</p><h3 id="重构-ProductList-组件"><a href="#重构-ProductList-组件" class="headerlink" title="重构 ProductList 组件"></a>重构 ProductList 组件</h3><p>有了 ProductButton 和 ProductItem，我们便可以来重构之前略显臃肿的 ProductList 组件了，修改 <code>src/components/products/ProductList.vue</code>，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;components&#x2F;products&#x2F;ProductList.vue --&gt;</span><br><span class="line">&lt;!-- ... --&gt;</span><br><span class="line">        This is ProductList</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;template v-for&#x3D;&quot;product in products&quot;&gt;</span><br><span class="line">       &lt;product-item :product&#x3D;&quot;product&quot; :key&#x3D;&quot;product._id&quot;&gt;&lt;&#x2F;product-item&gt;</span><br><span class="line">      &lt;&#x2F;template&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ProductItem from &#39;.&#x2F;ProductItem.vue&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    &#39;product-item&#39;: ProductItem</span><br><span class="line">  &#125;,</span><br><span class="line">  name: &#39;product-list&#39;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    if (this.products.length &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">      this.$store.dispatch(&#39;allProducts&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    products() &#123;</span><br><span class="line">      return this.$store.state.products</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addToCart(product) &#123;</span><br><span class="line">      this.$store.commit(&#39;ADD_TO_CART&#39;, &#123;</span><br><span class="line">        product</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.product&#123;</span><br><span class="line">  border-bottom: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line">.product_image&#123;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>这部分代码是将之前展示商品信息的逻辑代码封装到了子组件 <code>ProductItem</code> 中，然后导入并注册子组件 <code>ProductItem</code>，再将子组件挂载到模板中。</p><p>可以看到，我们通过 <code>this.$store.state.products</code> 从本地获取 <code>products</code> 数组，并返回给计算属性 <code>products</code>。然后在模板中利用 <code>v-for</code> 遍历 <code>products</code> 数组，并将每个 <code>product</code> 对象传给每个子组件 <code>ProductItem</code>，在每个子组件中展示对应的商品信息。</p><h3 id="重构-Cart-组件"><a href="#重构-Cart-组件" class="headerlink" title="重构 Cart 组件"></a>重构 Cart 组件</h3><p>最后，我们重构一波购物车组件 <code>src/pages/Cart.vue</code>，也使用了子组件 <code>ProductItem</code> 简化了页面逻辑，修改代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;pages&#x2F;Cart.vue --&gt;</span><br><span class="line"> &lt;!-- ... --&gt;</span><br><span class="line">      &lt;h1&gt;&#123;&#123;msg&#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;template v-for&#x3D;&quot;product in cart&quot;&gt;</span><br><span class="line">     &lt;product-item :product&#x3D;&quot;product&quot; :key&#x3D;&quot;product._id&quot;&gt;&lt;&#x2F;product-item&gt;</span><br><span class="line">    &lt;&#x2F;template&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ProductItem from &#39;..&#x2F;components&#x2F;products&#x2F;ProductItem.vue&#39;</span><br><span class="line">  export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    &#39;product-item&#39;: ProductItem</span><br><span class="line">  &#125;,</span><br><span class="line">    name: &#39;home&#39;,</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        msg: &#39;Welcome to the Cart Page&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      cart() &#123;</span><br><span class="line">        return this.$store.state.cart</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      removeFromCart(productId) &#123;</span><br><span class="line">        this.$store.commit(&#39;REMOVE_FROM_CART&#39;, &#123;</span><br><span class="line">          productId</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.product&#123;</span><br><span class="line">  border-bottom: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line">.product_image&#123;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>这里也是首先导入并注册子组件 <code>ProductItem</code>，然后在模板中挂载子组件。通过 <code>this.$store.state.cart</code> 的方式从本地获取购物车数组，并返回给计算属性 <code>cart</code>。在模板中通过 <code>v-for</code> 遍历购物车数组，并将购物车中每个商品对象传给对应的子组件 <code>ProductItem</code>，通过子组件来展示对应的商品信息。</p><p>把项目开起来，查看商品列表，可以看到每个商品下面都增加了 “添加到购物车” 按钮!</p><p>购物车中，也有了 “移出购物车” 按钮!</p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>这一节我们学习了如何使用 Vue 组件来简化页面逻辑：</p><ul><li>首先我们需要通过 <code>import</code> 的方式导入子组件。</li><li>然后在 <code>components</code> 中注册子组件。</li><li>最后将子组件挂载到模板中，并将需要子组件展示的数据传给子组件。</li></ul><h2 id="使用-Vuex-Getters-复用本地数据获取逻辑"><a href="#使用-Vuex-Getters-复用本地数据获取逻辑" class="headerlink" title="使用 Vuex Getters 复用本地数据获取逻辑"></a>使用 Vuex Getters 复用本地数据获取逻辑</h2><p>之前我们使用 Vuex 进行状态管理是通过 <code>this.$store.state</code> 的方式获取本地数据，而在这里我们使用 <code>Vuex Getters</code> 来复用本地数据的获取逻辑。</p><p><code>Vuex</code> 允许我们在 <code>store</code> 中定义 “getter”（可以认为是 <code>store</code> 的计算属性）。就像计算属性一样，<code>getter</code> 的返回值会根据它的依赖被缓存起来，且只有当它的依赖值发生了改变才会被重新计算。</p><p><code>Getter</code> 也是定义在 Vuex Store 的 <code>getter</code> 属性中的一系列方法，用于获取本地状态中的数据。我们可以通过两种方式访问 <code>getter</code>，一个是通过属性访问，另一个是通过方法访问：</p><ul><li><strong>属性访问</strong>的方式为 <code>this.$store.getter.allProducts</code>，对应的 <code>getter</code> 如下：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">allProducts(state) &#123;</span><br><span class="line">    &#x2F;&#x2F; 返回本地中的数据</span><br><span class="line">    return state.products;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>方法访问</strong>的方式为 <code>this.$store.getter.productById(id)</code>，对应的 <code>getter</code> 如下：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">productById: (state, getters) &#x3D;&gt; id &#x3D;&gt; &#123;</span><br><span class="line">      &#x2F;&#x2F;通过传入的id参数进行一系列操作并返回本地数据</span><br><span class="line">      return state.product;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>我们可以看到 <code>Getter</code> 可以接受两个参数：<code>state</code> 和 <code>getters</code>，<code>state</code> 就表示本地数据源；我们可以通过第二个参数 <code>getters</code> 获取到不同的 <code>getter</code> 属性。</p><h3 id="定义-Vuex-Getters"><a href="#定义-Vuex-Getters" class="headerlink" title="定义 Vuex Getters"></a>定义 Vuex Getters</h3><p>光说不练假把式，我们来手撸几个 getters。打开 <code>src/store/index.js</code> 文件，我们添加了一些需要用到的 <code>action</code> 属性、<code>mutation</code> 属性以及这一节的主角 —— <code>getters</code>。代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue-online-shop-frontend/src/store/index.js</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">      state.showLoader = <span class="literal">false</span></span><br><span class="line">      state.products = products</span><br><span class="line">    &#125;,</span><br><span class="line">    PRODUCT_BY_ID(state) &#123;</span><br><span class="line">      state.showLoader = <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    PRODUCT_BY_ID_SUCCESS(state, payload) &#123;</span><br><span class="line">      state.showLoader = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; product &#125; = payload</span><br><span class="line">      state.product = product</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    allProducts(state) &#123;</span><br><span class="line">      <span class="keyword">return</span> state.products</span><br><span class="line">    &#125;,</span><br><span class="line">    productById: <span class="function">(<span class="params">state, getters</span>) =&gt;</span> <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (getters.allProducts.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> getters.allProducts.filter(<span class="function"><span class="params">p</span> =&gt;</span> p._id == id)[<span class="number">0</span>]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state.product</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">          products: response.data</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    productById(&#123; commit &#125;, payload) &#123;</span><br><span class="line">      commit(<span class="string">'PRODUCT_BY_ID'</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; productId &#125; = payload</span><br><span class="line">      axios.get(<span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/products/<span class="subst">$&#123;productId&#125;</span>`</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        commit(<span class="string">'PRODUCT_BY_ID_SUCCESS'</span>, &#123;</span><br><span class="line">          product: response.data</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这里主要添加了三部分内容：</p><ul><li>在 actions 中添加了 productById 属性，当视图层通过指定 id 分发到类型为 PRODUCT_BY_ID 的 action 中，这里会进行异步操作从后端获取指定商品，并将该商品提交到对应类型的 mutation 中，就来到了下一步。</li><li>在 mutations 中添加了 PRODUCT_BY_ID 和 PRODUCT_BY_ID_SUCCESS 属性，响应指定类型提交的事件，将提交过来的商品保存到本地。</li><li>添加了 <code>getters</code>并在 <code>getters</code> 中添加了 <code>allProducts</code> 属性和 <code>productById</code> 方法，用于获取本地数据。在 <code>allProducts</code> 中获取本地中所有的商品；在 <code>productById</code> 通过传入的 id 查找本地商品中是否存在该商品，如果存在则返回该商品，如果不存在则返回空对象。</li></ul><h3 id="在后台-Products-组件中使用-Getters"><a href="#在后台-Products-组件中使用-Getters" class="headerlink" title="在后台 Products 组件中使用 Getters"></a>在后台 Products 组件中使用 Getters</h3><p>我们先通过一个简单的例子演示如果使用 Vuex Getters。打开后台商品组件，<code>src/pages/admin/Products.vue</code>，我们通过属性访问的方式调用对应的 <code>getter</code> 属性，从而获取本地商品，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;pages&#x2F;admin&#x2F;Products.vue --&gt;</span><br><span class="line"> &lt;!-- ... --&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    product() &#123;</span><br><span class="line">      return this.$store.getters.allProducts[0]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>我们通过 <code>this.$store.getters.allProducts</code> 属性访问的方式调用对应 <code>getter</code> 中的 <code>allProducts</code> 属性，并返回本地商品数组中的第一个商品。</p><h3 id="创建-ProductDetail-组件"><a href="#创建-ProductDetail-组件" class="headerlink" title="创建 ProductDetail 组件"></a>创建 ProductDetail 组件</h3><p>接着开始实现商品详情组件 <code>src/components/products/ProductDetail.vue</code>，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;components&#x2F;products&#x2F;ProductDetail.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;product-details&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;product-details_image&quot;&gt;</span><br><span class="line">      &lt;img :src&#x3D;&quot;product.image&quot; alt&#x3D;&quot;&quot; class&#x3D;&quot;image&quot;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;product-details_info&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;product-details_description&quot;&gt;</span><br><span class="line">        &lt;small&gt;&#123;&#123;product.manufacturer.name&#125;&#125;&lt;&#x2F;small&gt;</span><br><span class="line">        &lt;h3&gt;&#123;&#123;product.name&#125;&#125;&lt;&#x2F;h3&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123;product.description&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;product-details_price-cart&quot;&gt;</span><br><span class="line">        &lt;p&gt;&#123;&#123;product.price&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">        &lt;product-button :product&#x3D;&quot;product&quot;&gt;&lt;&#x2F;product-button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ProductButton from &#39;.&#x2F;ProductButton.vue&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">  props: [&#39;product&#39;],</span><br><span class="line">  components: &#123;</span><br><span class="line">    &#39;product-button&#39;: ProductButton</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.product-details_image .image&#123;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>该组件将父组件传入的 <code>product</code> 对象展示在了模板中，并复用了 <code>ProductButton</code> 组件。</p><h3 id="在-ProductItem-组件中添加链接"><a href="#在-ProductItem-组件中添加链接" class="headerlink" title="在 ProductItem 组件中添加链接"></a>在 ProductItem 组件中添加链接</h3><p>有了商品详情，我们还需要进入详情的链接。再次进入 <code>src/components/products/ProductItem.vue</code> 文件中，我们对其进行了修改，将模板中的商品信息用 Vue 原生组件 <code>router-link</code> 包裹起来，实现商品信息可点击查看详情。代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;components&#x2F;products&#x2F;ProductItem.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;product&quot;&gt;</span><br><span class="line">      &lt;router-link :to&#x3D;&quot;&#39;&#x2F;detail&#x2F;&#39; + product._id&quot; class&#x3D;&quot;product-link&quot;&gt;</span><br><span class="line">        &lt;p class&#x3D;&quot;product_name&quot;&gt;产品名称：&#123;&#123;product.name&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">        &lt;p class&#x3D;&quot;product_description&quot;&gt;介绍：&#123;&#123;product.description&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">        &lt;p class&#x3D;&quot;product_price&quot;&gt;价格：&#123;&#123;product.price&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">        &lt;p class&#x3D;&quot;product_manufacturer&quot;&gt;生产厂商：&#123;&#123;product.manufacturer.name&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">        &lt;img :src&#x3D;&quot;product.image&quot; alt&#x3D;&quot;&quot; class&#x3D;&quot;product_image&quot;&gt;</span><br><span class="line">      &lt;&#x2F;router-link&gt;</span><br><span class="line">      &lt;product-button :product&#x3D;&quot;product&quot;&gt;&lt;&#x2F;product-button&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;!-- ... --&gt;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.product&#123;</span><br><span class="line">  border-bottom: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line">.product_image&#123;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>该组件经过修改之后实现了点击商品的任何一条信息，都会触发路由跳转到商品详情页，并将该商品 id 通过动态路由的方式传递到详情页。</p><h3 id="在-ProductList-中使用-Getters"><a href="#在-ProductList-中使用-Getters" class="headerlink" title="在 ProductList 中使用 Getters"></a>在 ProductList 中使用 Getters</h3><p>修改商品列表组件 <code>src/components/products/ProductList.vue</code> 文件，使用了 Vuex Getters 复用了本地数据获取逻辑，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;components&#x2F;products&#x2F;ProductList.vue --&gt;</span><br><span class="line">&lt;!-- ... --&gt;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    products() &#123;</span><br><span class="line">      return this.$store.getters.allProducts</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addToCart(product) &#123;</span><br><span class="line">      this.$store.commit(&#39;ADD_TO_CART&#39;, &#123;</span><br><span class="line">        product</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.product&#123;</span><br><span class="line">  border-bottom: 1px solid black;</span><br><span class="line">&#125;</span><br><span class="line">.product_image&#123;</span><br><span class="line">  width: 100px;</span><br><span class="line">  height: 100px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>我们在计算属性 <code>products</code> 中使用 <code>this.$store.getters.allProducts</code> 属性访问的方式调用 <code>getters</code> 中的 <code>allProducts</code> 属性，我们也知道在对应的 <code>getter</code> 中获取到了本地中的 <code>products</code> 数组。</p><h3 id="创建-Detail-页面组件"><a href="#创建-Detail-页面组件" class="headerlink" title="创建 Detail 页面组件"></a>创建 Detail 页面组件</h3><p>实现了 ProductDetail 子组件之后，我们便可以搭建商品详情我页面组件 <code>src/pages/Detail.vue</code>，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- vue-online-shop-frontend&#x2F;src&#x2F;pages&#x2F;Detail.vue --&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;product-detail :product&#x3D;&quot;product&quot;&gt;&lt;&#x2F;product-detail&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ProductDetail from &#39;..&#x2F;components&#x2F;products&#x2F;ProductDetail.vue&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    &#39;product-detail&#39;: ProductDetail</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    &#x2F;&#x2F; 跳转到详情时，如果本地状态里面不存在此商品，从后端获取此商品详情</span><br><span class="line">    const &#123; name &#125; &#x3D; this.product</span><br><span class="line">    if (!name) &#123;</span><br><span class="line">      this.$store.dispatch(&#39;productById&#39;, &#123;</span><br><span class="line">        productId: this.$route.params[&#39;id&#39;]</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    product() &#123;</span><br><span class="line">      return this.$store.getters.productById(this.$route.params[&#39;id&#39;])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><p>该组件中定义了一个计算属性 <code>product</code>，用于返回本地状态中指定的商品。这里我们使用了 <code>this.$store.getters.productById(id)</code> 方法访问的方式获取本地中指定的商品，这里的 id 参数通过 <code>this.$route.params[&#39;id&#39;]</code> 从当前处于激活状态的路由对象中获取，并传入对应的 <code>getter</code> 中，进而从本地中获取指定商品。</p><p>在该组件刚被创建时判断当前本地中是否有该商品，如果没有则通过 <code>this.$store.dispatch</code> 的方式将包含当前商品 id 的对象作为载荷分发到类型为 <code>productById</code> 的 <code>action</code> 中，在 <code>action</code> 中进行异步操作从后端获取指定商品，然后提交到对应的 <code>mutation</code> 中进行本地状态修改，这已经使我们习惯的思路了。</p><h3 id="配置-Detail-页面的路由"><a href="#配置-Detail-页面的路由" class="headerlink" title="配置 Detail 页面的路由"></a>配置 Detail 页面的路由</h3><p>最后我们打开路由配置 <code>src/router/index.js</code> 文件，导入了 <code>Detail</code> 组件，并添加了对应的路由参数，代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue-online-shop-frontend/src/router/index.js</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'@/pages/Home'</span>;</span><br><span class="line"><span class="keyword">import</span> Cart <span class="keyword">from</span> <span class="string">'@/pages/Cart'</span>;</span><br><span class="line"><span class="keyword">import</span> Detail <span class="keyword">from</span> <span class="string">'@/pages/Detail'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Admin Components</span></span><br><span class="line"><span class="keyword">import</span> Index <span class="keyword">from</span> <span class="string">'@/pages/admin/Index'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">      path: <span class="string">'/cart'</span>,</span><br><span class="line">      name: <span class="string">'Cart'</span>,</span><br><span class="line">      component: Cart,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/detail/:id'</span>,</span><br><span class="line">      name: <span class="string">'Detail'</span>,</span><br><span class="line">      component: Detail</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>又到了验收的环节，运行项目，点击单个商品，可以进入到商品详情页面，并且数据是完全一致的：</p><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>这一节中我们学会了如何使用 <code>Vuex Getters</code> 来复用本地数据的获取逻辑：</p><ul><li>我们需要先在 <code>store</code> 实例中添加 <code>getters</code> 属性，并在 <code>getters</code> 属性中定义不同的属性或者方法。</li><li>在这些不同类型的 <code>getter</code> 中，我们可以获取本地数据。</li><li>我们可以通过属性访问和方法访问的方式来调用我们的 <code>getter</code>。</li></ul></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Brookliu</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://brookliu.xyz/2020/01/30/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E5%9B%9B%EF%BC%89/" title="从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（四）">https://brookliu.xyz/2020/01/30/从零到部署：用-Vue-和-Express-实现迷你全栈电商应用（四）/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Node/" rel="tag"><i class="fa fa-tag"></i> # Node</a><a href="/tags/Express/" rel="tag"><i class="fa fa-tag"></i> # Express</a><a href="/tags/Vue/" rel="tag"><i class="fa fa-tag"></i> # Vue</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/01/28/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80%E7%9A%84%E5%B8%B8%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%AF%B9%E6%AF%94-%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2%E3%80%81%E7%99%BE%E5%88%86%E6%AF%94%E3%80%81rem%E5%92%8Cvw-vh/" rel="prev" title="响应式布局的常用解决方案对比(媒体查询、百分比、rem和vw/vh)"><i class="fa fa-chevron-left"></i> 响应式布局的常用解决方案对比(媒体查询、百分比、rem和vw/vh)</a></div><div class="post-nav-item"> <a href="/2020/02/02/%E4%BB%8E%E9%9B%B6%E5%88%B0%E9%83%A8%E7%BD%B2%EF%BC%9A%E7%94%A8-Vue-%E5%92%8C-Express-%E5%AE%9E%E7%8E%B0%E8%BF%B7%E4%BD%A0%E5%85%A8%E6%A0%88%E7%94%B5%E5%95%86%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%94%EF%BC%89/" rel="next" title="从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（五）">从零到部署：用 Vue 和 Express 实现迷你全栈电商应用（五）<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Vue-组件简化页面逻辑"><span class="nav-number">1.</span> <span class="nav-text">使用 Vue 组件简化页面逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#实现-ProductButton-组件"><span class="nav-number">1.1.</span> <span class="nav-text">实现 ProductButton 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现-ProductItem-组件"><span class="nav-number">1.2.</span> <span class="nav-text">实现 ProductItem 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-ProductList-组件"><span class="nav-number">1.3.</span> <span class="nav-text">重构 ProductList 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重构-Cart-组件"><span class="nav-number">1.4.</span> <span class="nav-text">重构 Cart 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结"><span class="nav-number">1.5.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用-Vuex-Getters-复用本地数据获取逻辑"><span class="nav-number">2.</span> <span class="nav-text">使用 Vuex Getters 复用本地数据获取逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#定义-Vuex-Getters"><span class="nav-number">2.1.</span> <span class="nav-text">定义 Vuex Getters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在后台-Products-组件中使用-Getters"><span class="nav-number">2.2.</span> <span class="nav-text">在后台 Products 组件中使用 Getters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-ProductDetail-组件"><span class="nav-number">2.3.</span> <span class="nav-text">创建 ProductDetail 组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在-ProductItem-组件中添加链接"><span class="nav-number">2.4.</span> <span class="nav-text">在 ProductItem 组件中添加链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在-ProductList-中使用-Getters"><span class="nav-number">2.5.</span> <span class="nav-text">在 ProductList 中使用 Getters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建-Detail-页面组件"><span class="nav-number">2.6.</span> <span class="nav-text">创建 Detail 页面组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-Detail-页面的路由"><span class="nav-number">2.7.</span> <span class="nav-text">配置 Detail 页面的路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小结-1"><span class="nav-number">2.8.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Brookliu" src="/images/logo.png"><p class="site-author-name" itemprop="name">Brookliu</p><div class="site-description" itemprop="description">扶我起来，我还能写</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">92</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/liubrook" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;liubrook" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://juejin.im/user/588993964030574" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;588993964030574" rel="noopener" target="_blank"><i class="fa fa-spinner fa-fw"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/lqpf199681" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;lqpf199681" rel="noopener" target="_blank"><i class="fa fa-crossjairs fa-fw"></i> CSDN</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://www.zhangxinxu.com/" title="http:&#x2F;&#x2F;www.zhangxinxu.com&#x2F;" rel="noopener" target="_blank">张鑫旭</a></li><li class="links-of-blogroll-item"> <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a></li><li class="links-of-blogroll-item"> <a href="http://ife.baidu.com/" title="http:&#x2F;&#x2F;ife.baidu.com&#x2F;" rel="noopener" target="_blank">百度前端技术学院</a></li><li class="links-of-blogroll-item"> <a href="http://wf.uisdc.com/cn/" title="http:&#x2F;&#x2F;wf.uisdc.com&#x2F;cn&#x2F;" rel="noopener" target="_blank">google前端开发基础</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright"> &copy; 2019 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-star"></i></span> <span class="author" itemprop="copyrightHolder">by 1024肥宅</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv"></span></span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fb642a4fe3376d3" async="async"></script></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共163.7k字</span></div><div class="weixin-box"><div class="weixin-menu"><div class="weixin-hover"><div class="weixin-description">微信扫一扫，订阅本博客</div></div></div></div><style>#comments .veditor{min-height:10rem;background-image:url(https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200425091751.png);background-size:contain;background-repeat:no-repeat;background-position:right;background-color:rgba(255,255,255,0);resize:none}</style><script>
    //   自定义邮箱审核规则
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('vsubmit')) {
            const email = document.querySelector('input[type=email]');
            const nick = document.querySelector('input[name=nick]');
            const reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if (!email.value || !nick.value || !reg.test(email.value)) {
                const str = `<div class="valert text-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                const vmark = document.querySelector('.vmark');
                vmark.innerHTML = str;
                vmark.style.display = 'block';
                setTimeout(function() {
                    vmark.style.display = 'none';
                    vmark.innerHTML = '';
                }, 2500);
            }
        }
    })
</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz","app_key":"Q0n1AFSDoyYQsw7RI9eC1rfP","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script size="300" alpha="0.6" zindex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="/js/local-search.js"></script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz',
      appKey     : 'Q0n1AFSDoyYQsw7RI9eC1rfP',
      placeholder: "(。・∀・)ノ )",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-CN' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><script type="text/javascript" src="/js/clicklove.js"></script><script async>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>