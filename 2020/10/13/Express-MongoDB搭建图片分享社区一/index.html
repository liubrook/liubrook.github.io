<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png"><link rel="mask-icon" href="/images/logo.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=EB Garamond:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"brookliu.xyz",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"./public/search.xml"}</script><meta name="description" content="初始化项目结构首先创建目录，并初始化(如果你想放在GitHub上的话，先在GitHub上建一个仓库然后clone下来)：初始化的时候可以一路enter下来，如果你不在意的话。"><meta property="og:type" content="article"><meta property="og:title" content="Express+MongoDB搭建图片分享社区一"><meta property="og:url" content="https://brookliu.xyz/2020/10/13/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%B8%80/index.html"><meta property="og:site_name" content="1024肥宅"><meta property="og:description" content="初始化项目结构首先创建目录，并初始化(如果你想放在GitHub上的话，先在GitHub上建一个仓库然后clone下来)：初始化的时候可以一路enter下来，如果你不在意的话。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://static.tuture.co/c/69b697ed0cd9f890a636c9c78eb2ce0c/figure-2.png"><meta property="og:image" content="https://static.tuture.co/c/69b697ed0cd9f890a636c9c78eb2ce0c/figure-3.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/express%2BmongoDB-1-1.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/express%2BmongoDB-1-2.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/express%2BmongoDB-1-3.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/express%2BmongoDB-1-4.png"><meta property="article:published_time" content="2020-10-13T01:44:19.000Z"><meta property="article:modified_time" content="2020-10-13T07:09:48.000Z"><meta property="article:author" content="Brookliu"><meta property="article:tag" content="Node"><meta property="article:tag" content="Express"><meta property="article:tag" content="MongoDB"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://static.tuture.co/c/69b697ed0cd9f890a636c9c78eb2ce0c/figure-2.png"><link rel="canonical" href="https://brookliu.xyz/2020/10/13/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%B8%80/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Express+MongoDB搭建图片分享社区一 | 1024肥宅</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="1024肥宅" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a href="https://github.com/liubrook" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">1024肥宅</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签<span class="badge">20</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类<span class="badge">18</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档<span class="badge">64</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/liubrook" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://brookliu.xyz/2020/10/13/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%B8%80/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/logo.png"><meta itemprop="name" content="Brookliu"><meta itemprop="description" content="扶我起来，我还能写"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="1024肥宅"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Express+MongoDB搭建图片分享社区一</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-10-13 09:44:19 / 修改时间：15:09:48" itemprop="dateCreated datePublished" datetime="2020-10-13T09:44:19+08:00">2020-10-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Node/" itemprop="url" rel="index"><span itemprop="name">Node</span></a></span></span><span id="/2020/10/13/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%B8%80/" class="post-meta-item leancloud_visitors" data-flag-title="Express+MongoDB搭建图片分享社区一" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/2020/10/13/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%B8%80/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/10/13/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%B8%80/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="初始化项目结构"><a href="#初始化项目结构" class="headerlink" title="初始化项目结构"></a>初始化项目结构</h3><p>首先创建目录，并初始化(如果你想放在GitHub上的话，先在GitHub上建一个仓库然后clone下来)：<br>初始化的时候可以一路enter下来，如果你不在意的话。</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir Instagrammy &amp;&amp; cd Instagrammy</span><br><span class="line"></span><br><span class="line">npm init</span><br></pre></td></tr></table></figure><p>安装express</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express</span><br></pre></td></tr></table></figure><p>最终生成的package.json文件如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;instagrammy&quot;,</span><br><span class="line">  &quot;version&quot;: &quot;1.0.0&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;&quot;,</span><br><span class="line">  &quot;main&quot;: &quot;index.js&quot;,</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;keywords&quot;: [],</span><br><span class="line">  &quot;author&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license&quot;: &quot;ISC&quot;,</span><br><span class="line">  &quot;dependencies&quot;: &#123;</span><br><span class="line">    &quot;express&quot;: &quot;^4.17.1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在项目根目录新建入口文件server.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line"></span><br><span class="line">app &#x3D; express();</span><br><span class="line"></span><br><span class="line">app.set(&#39;port&#39;, process.env.PORT || 3000);</span><br><span class="line"></span><br><span class="line">app.get(&#39;&#x2F;&#39;, function(req, res) &#123;</span><br><span class="line">    res.send(&#39;Hello World!&#39;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(app.get(&#39;port&#39;), function() &#123;</span><br><span class="line">    console.log(&#96;Server is running on http:&#x2F;&#x2F;localhost:$&#123;app.get(&#39;port&#39;)&#125;&#96;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>运行<code>node server.js</code>，然后在浏览器中访问<a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a>，就可以在页面上看到服务器返回的Hello World!</p><p>这里为了接下去运行项目方便，我们在package.json中添加启动命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node server.js&quot;,</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置中间件"><a href="#配置中间件" class="headerlink" title="配置中间件"></a>配置中间件</h3><p>Express 本身是一个非常简洁的 web 框架，但是通过中间件这一设计模式，能够实现非常丰富的功能。一个 Express 中间件本质上是一个函数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function someMiddleware(req, res, next) &#123;&#125;</span><br></pre></td></tr></table></figure><p>req 参数是一个 express.Request 对象，封装了用户请求；res 参数则是一个 express.Response 对象，封装了即将返回给用户的响应；next 则是在执行完所有逻辑后用于触发下一个中间件的函数。</p><p>添加中间件的代码则非常简单：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(middlewareA);</span><br><span class="line">app.use(middlewareB);</span><br><span class="line">app.use(middlewareC);</span><br></pre></td></tr></table></figure><p>中间件 A、B、C 将会在处理每次请求时按顺序执行（这也意味着中间件的顺序是非常重要的）。接下来我们将添加以下基础中间件（也是几乎所有应用都会用到的中间件）：</p><ul><li>morgan：用于记录日志的中间件，对于开发调试和生产监控都很有用；</li><li>bodyParser：用于解析客户端请求的中间件，包括 HTML 表单和 JSON 请求；</li><li>methodOverride：为老的浏览器提供 REST 请求的兼容性支持；</li><li>cookieParser：用于收发 cookie；</li><li>errorHandler：用于在发生错误时打印调用栈，仅在开发时使用；</li><li>handlebars：用于渲染用户界面的模板引擎，会在后面细讲。</li></ul><p>我们通过 npm 安装这些中间件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express-handlebars body-parser cookie-parser morgan method-override errorhandler</span><br></pre></td></tr></table></figure><p>在项目根目录创建server目录，在server目录下创建configure.js文件用于配置所有的中间件，文件内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const exphbs &#x3D; require(&#39;express-handlebars&#39;);</span><br><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line">const bodyParser &#x3D; require(&#39;body-parser&#39;);</span><br><span class="line">const cookieParser &#x3D; require(&#39;cookie-parser&#39;);</span><br><span class="line">const morgan &#x3D; require(&#39;morgan&#39;);</span><br><span class="line">const methodOverride &#x3D; require(&#39;method-override&#39;);</span><br><span class="line">const errorHandler &#x3D; require(&#39;errorhandler&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; function(app) &#123;</span><br><span class="line">    app.use(morgan(&#39;dev&#39;));</span><br><span class="line">    app.use(bodyParser.urlencoded(&#123; extended: true &#125;));</span><br><span class="line">    app.use(bodyParser.json());</span><br><span class="line">    app.use(methodOverride());</span><br><span class="line">    app.use(cookieParser(&#39;secret-value&#39;));</span><br><span class="line">    app.use(&#39;&#x2F;public&#x2F;&#39;, express.static(path.join(__dirname, &#39;..&#x2F;public&#39;)));</span><br><span class="line"></span><br><span class="line">    if (app.get(&#39;env&#39;) &#x3D;&#x3D;&#x3D; &#39;development&#39;) &#123;</span><br><span class="line">        app.use(errorHandler())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return app;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>express.static是express自带的静态资源中间件，用于向客户端发送图片、css等静态文件。最后，我们通过env变量来判断是否处于开发环境，如果是的话就添加errorHandler以便于调试代码。</p><p>在server.js中调用刚才配置中间件的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line">const configure &#x3D; require(&#39;.&#x2F;server&#x2F;configure&#39;);</span><br><span class="line"></span><br><span class="line">app &#x3D; express();</span><br><span class="line">app &#x3D; configure(app);</span><br><span class="line"></span><br><span class="line">app.set(&#39;port&#39;, process.env.PORT || 3000);</span><br><span class="line"></span><br><span class="line">app.get(&#39;&#x2F;&#39;, function(req, res) &#123;</span><br><span class="line">    res.send(&#39;Hello World!&#39;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(app.get(&#39;port&#39;), function() &#123;</span><br><span class="line">    console.log(&#96;Server is running on http:&#x2F;&#x2F;localhost:$&#123;app.get(&#39;port&#39;)&#125;&#96;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="搭建路由和控制器"><a href="#搭建路由和控制器" class="headerlink" title="搭建路由和控制器"></a>搭建路由和控制器</h3><p>在上面的步骤中我们配置好了基础的中间件，但是只有主页(/)可以访问，下面我们要实现以下路由:</p><ul><li>GET /：网站主页。</li><li>GET /images/image_id：展示单张图片。</li><li>POST /images：上传图片。</li><li>POST /images/image_id/like：点赞图片。</li><li>POST /images/image_id/comment：评论图片。</li></ul><p>我们采用前端最熟悉的MVC模式来搭建下面的内容。</p><p>首先创建controllers目录，在该目录下新建home.js文件定义index控制器，代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  index: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The home:index controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>每个控制器实际上都是一个 Express 中间件（只不过不需要 next 函数，因为是最后一个中间件）。这里我们暂时用 res.send 发一条文字来代表这个 controller 已经实现。</p><p>再在 controllers 目录下创建 image.js，实现与图片处理相关的控制器：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  index: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:index controller &#39; + req.params.image_id);</span><br><span class="line">  &#125;,</span><br><span class="line">  create: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:create POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">  like: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:like POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">  comment: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:comment POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>然后在 server 目录下创建路由模块 routes.js，建立从 URL 到控制器之间的映射：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line"></span><br><span class="line">const router &#x3D; express.Router();</span><br><span class="line">const home &#x3D; require(&#39;..&#x2F;controllers&#x2F;home&#39;);</span><br><span class="line">const image &#x3D; require(&#39;..&#x2F;controllers&#x2F;image&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; function(app) &#123;</span><br><span class="line">  router.get(&#39;&#x2F;&#39;, home.index);</span><br><span class="line">  router.get(&#39;&#x2F;images&#x2F;:image_id&#39;, image.index);</span><br><span class="line">  router.post(&#39;&#x2F;images&#39;, image.create);</span><br><span class="line">  router.post(&#39;&#x2F;images&#x2F;:image_id&#x2F;like&#39;, image.like);</span><br><span class="line">  router.post(&#39;&#x2F;images&#x2F;:image_id&#x2F;comment&#39;, image.comment);</span><br><span class="line">  app.use(router);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这里我们用到了 Express 自带的路由类 Router，可以很方便地定义路由，并且 Router 本身也是一个中间件，可以直接通过 app.use 进行配置。</p><p>接着在 server/configure.js 模块中调用路由模块。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const exphbs &#x3D; require(&#39;express-handlebars&#39;);</span><br><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line">const bodyParser &#x3D; require(&#39;body-parser&#39;);</span><br><span class="line">const cookieParser &#x3D; require(&#39;cookie-parser&#39;);</span><br><span class="line">const morgan &#x3D; require(&#39;morgan&#39;);</span><br><span class="line">const methodOverride &#x3D; require(&#39;method-override&#39;);</span><br><span class="line">const errorHandler &#x3D; require(&#39;errorhandler&#39;);</span><br><span class="line"></span><br><span class="line">const routes &#x3D; require(&#39;.&#x2F;routes&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; function(app) &#123;</span><br><span class="line">  app.use(morgan(&#39;dev&#39;));</span><br><span class="line">  app.use(bodyParser.urlencoded(&#123; extended: true &#125;));</span><br><span class="line">  app.use(bodyParser.json());</span><br><span class="line">  app.use(methodOverride());</span><br><span class="line">  app.use(cookieParser(&#39;secret-value&#39;));</span><br><span class="line">  app.use(&#39;&#x2F;public&#x2F;&#39;, express.static(path.join(__dirname, &#39;..&#x2F;public&#39;)));</span><br><span class="line"></span><br><span class="line">  if (app.get(&#39;env&#39;) &#x3D;&#x3D;&#x3D; &#39;development&#39;) &#123;</span><br><span class="line">    app.use(errorHandler());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  routes(app);</span><br><span class="line">  return app;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>最后我们去掉 server.js 中原来的首页路由。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line">const configure &#x3D; require(&#39;.&#x2F;server&#x2F;configure&#39;);</span><br><span class="line"></span><br><span class="line">app &#x3D; express();</span><br><span class="line">app &#x3D; configure(app);</span><br><span class="line">app.set(&#39;port&#39;, process.env.PORT || 3000);</span><br><span class="line"></span><br><span class="line">app.listen(app.get(&#39;port&#39;), function() &#123;</span><br><span class="line">  console.log(&#96;Server is running on http:&#x2F;&#x2F;localhost:$&#123;app.get(&#39;port&#39;)&#125;&#96;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>现在我们运行服务器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><p>打开浏览器访问<a href="http://localhost:3000" target="_blank" rel="noopener">localhost:3000</a>可以看到页面展示的The home:index controller。访问<a href="http://localhost:3000/images/test123" target="_blank" rel="noopener">localhost:3000/images/test123</a>，则是The image:index controller test123。</p><h3 id="配置handlebars模板引擎"><a href="#配置handlebars模板引擎" class="headerlink" title="配置handlebars模板引擎"></a>配置handlebars模板引擎</h3><p>这一步我们来实现界面展示，首页的效果如下图所示：<br><img src="https://static.tuture.co/c/69b697ed0cd9f890a636c9c78eb2ce0c/figure-2.png" alt="首页效果图"></p><p>图片详情页的效果如下图:<br><img src="https://static.tuture.co/c/69b697ed0cd9f890a636c9c78eb2ce0c/figure-3.png" alt="图片详情页"></p><p>尽管如今前后端分离已经是大势所趋，但是通过模板引擎在服务器端渲染页面也是有用武之地的，特别是快速地开发一些简单的应用。在模板引擎中，<a href="https://handlebarsjs.com/" target="_blank" rel="noopener">Handlebars</a> 和 <a href="https://pugjs.org/api/getting-started.html" target="_blank" rel="noopener">Pug</a> 当属其中的佼佼者。由于 Handlebars 和普通的 HTML 文档几乎完全一致，容易上手，因此这篇教程中我们选用 Handlebars，并且选用 Bootstrap 样式。</p><p>与普通的 HTML 文档相比，模板最大的特点即在于提供了数据的接入。例如 handlebars，可以在双花括号 &#123;&#123; &#125;&#125; 之间填写任何数据，当服务器渲染页面时只需传入相应的数据即可渲染成对应的内容。除此之外，handlebars 还支持条件语法、循环语法和模板嵌套等高级功能，下面将详细描述。</p><p>我们创建一个 views 目录，用于存放所有的模板代码。views 目录的结构如下所示：<br><img src="https://img.brookliu.xyz/blog/express%2BmongoDB-1-1.png" alt="view目录"></p><p>其中 image.handlebars 和 index.handlebars 是页面模板，layouts/main.handlebars 则是整个网站的布局模板（所有页面共享），partials 目录则用于存放页面之间共享的组件模板，例如评论、数据等等。</p><p>首先完成布局模板 layouts/main.handlebars：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Instagrammy&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;http:&#x2F;&#x2F;netdna.bootstrapcdn.com&#x2F;bootstrap&#x2F;3.3.7&#x2F;css&#x2F;bootstrap.min.css&quot;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;page-header&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;col-md-6&quot;&gt;</span><br><span class="line">                &lt;h1&gt;&lt;a href&#x3D;&quot;&#x2F;&quot;&gt;Instagrammy&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;&#123;&#123;&#123;body&#125;&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>main.handlebars 本身是一个完整的 HTML 文档，包括 head 和 body 部分。在 head 部分，我们定义了网站的一些元数据，还加入了 Bootstrap 的 CDN 链接；在 body 部分，包含两个容器：网站头部（header）和每个页面的自定义内容（即 &#123;&#123;&#123;body&#125;&#125;&#125; ）。</p><p>接下来编写主页内容index.handlebars，页面内容先用标题占位:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Index Page&lt;&#x2F;h1&gt;</span><br></pre></td></tr></table></figure><p>图片详情页面内容:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Image Page&lt;&#x2F;h1&gt;</span><br></pre></td></tr></table></figure><p>index.handlebars 和 image.handlebars 的内容将替换布局模板中的 &#123;&#123;&#123;body&#125;&#125;&#125; 部分。在用户访问某个页面时，页面内容 = 布局模板 + 页面模板。</p><p>模板写好之后，我们修改控制器controller/home.js相应的代码，通过 res.render 函数渲染模板：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  index: function(req, res) &#123;</span><br><span class="line">    res.render(&#39;index&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>render 函数接受一个字符串参数，即页面模板的名称。例如 index.handlebars 的名称即为 index。</p><p>同样地，我们修改 image 控制器controllers/image.js的代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  index: function(req, res) &#123;</span><br><span class="line">    res.render(&#39;image&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">  create: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:create POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">  like: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:like POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">  comment: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:comment POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>最后在server/configure.js中配置handlebars中间件:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const exphbs &#x3D; require(&#39;express-handlebars&#39;);</span><br><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line">const bodyParser &#x3D; require(&#39;body-parser&#39;);</span><br><span class="line">const cookieParser &#x3D; require(&#39;cookie-parser&#39;);</span><br><span class="line">const morgan &#x3D; require(&#39;morgan&#39;);</span><br><span class="line">const methodOverride &#x3D; require(&#39;method-override&#39;);</span><br><span class="line">const errorHandler &#x3D; require(&#39;errorhandler&#39;);</span><br><span class="line"></span><br><span class="line">const routes &#x3D; require(&#39;.&#x2F;routes&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; function(app) &#123;</span><br><span class="line">  app.engine(&#39;handlebars&#39;, exphbs());</span><br><span class="line">  app.set(&#39;view engine&#39;, &#39;handlebars&#39;);</span><br><span class="line"></span><br><span class="line">  app.use(morgan(&#39;dev&#39;));</span><br><span class="line">  app.use(bodyParser.urlencoded(&#123; extended: true &#125;));</span><br><span class="line">  app.use(bodyParser.json());</span><br><span class="line">  app.use(methodOverride());</span><br><span class="line">  app.use(cookieParser(&#39;secret-value&#39;));</span><br><span class="line">  app.use(&#39;&#x2F;public&#x2F;&#39;, express.static(path.join(__dirname, &#39;..&#x2F;public&#39;)));</span><br><span class="line"></span><br><span class="line">  if (app.get(&#39;env&#39;) &#x3D;&#x3D;&#x3D; &#39;development&#39;) &#123;</span><br><span class="line">    app.use(errorHandler());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  routes(app);</span><br><span class="line">  return app;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>到这里我们这一步就完成了，现在<code>npm start</code>运行服务器，访问主页localhost:3000和图片详情页面localhost:3000/images/test就可以看到对应的页面了，虽然没有数据.</p><h3 id="完善页面代码"><a href="#完善页面代码" class="headerlink" title="完善页面代码"></a>完善页面代码</h3><p>首先在index.handlebars中添加上传图片的表单和展示最新图片的容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; views&#x2F;index.handlebars</span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-primary&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">    &lt;h3 class&#x3D;&quot;panel-title&quot;&gt;</span><br><span class="line">      上传图片</span><br><span class="line">    &lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;form action&#x3D;&quot;&#x2F;images&quot; method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;panel-body form-horizontal&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;form-group col-md-12&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;file&quot; class&#x3D;&quot;col-sm-2 control-label&quot;&gt;浏览:&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-10&quot;&gt;</span><br><span class="line">          &lt;input type&#x3D;&quot;file&quot; class&#x3D;&quot;form-control&quot; name&#x3D;&quot;file&quot; id&#x3D;&quot;file&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;form-group col-md-12&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;title&quot; class&#x3D;&quot;col-md-2 control-label&quot;&gt;标题:&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-10&quot;&gt;</span><br><span class="line">          &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; name&#x3D;&quot;title&quot;&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;form-group col-md-12&quot;&gt;</span><br><span class="line">        &lt;label for&#x3D;&quot;description&quot; class&#x3D;&quot;col-md-2 control-label&quot;&gt;描述:&lt;&#x2F;label&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-10&quot;&gt;</span><br><span class="line">          &lt;textarea name&#x3D;&quot;description&quot; rows&#x3D;&quot;2&quot; class&#x3D;&quot;form-control&quot;&gt;&lt;&#x2F;textarea&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;form-group col-md-12&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;col-md-12 text-right&quot;&gt;</span><br><span class="line">          &lt;button type&#x3D;&quot;submit&quot; id&#x3D;&quot;login-btn&quot; class&#x3D;&quot;btn btn-success&quot;&gt;</span><br><span class="line">            &lt;i class&#x3D;&quot;fa fa-cloud-upload&quot;&gt; 上传图片&lt;&#x2F;i&gt;</span><br><span class="line">          &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-default&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">    &lt;h3 class&#x3D;&quot;panel-title&quot;&gt;</span><br><span class="line">      最新图片</span><br><span class="line">    &lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">    &#123;&#123;#each images&#125;&#125;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-center&quot; style&#x3D;&quot;padding-bottom: 1em;&quot;&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;&#x2F;images&#x2F;&#123;&#123;uniqueId&#125;&#125;&quot;&gt;</span><br><span class="line">          &lt;img src&#x3D;&quot;&#x2F;public&#x2F;upload&#x2F;&#123;&#123;filename&#125;&#125;&quot; alt&#x3D;&quot;&#123;&#123;title&#125;&#125;&quot;</span><br><span class="line">            style&#x3D;&quot;width: 175px; height: 175px;&quot; class&#x3D;&quot;img-thumbnail&quot;&gt;</span><br><span class="line">        &lt;&#x2F;a&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &#123;&#123;&#x2F;each&#125;&#125;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>在展示最新图片时，我们用到了 handlebars 提供的循环语法（第 46 行到 53 行）。对于传入模板的数据对象 images 进行遍历，每个循环中可以访问单个 image 的全部属性，例如 uniqueId 等等。</p><p>接着完善 image.handlebars 的内容，包括展示图片的详细内容、发表评论的表单和展示所有评论的容器。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; views&#x2F;image.handlebars</span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-primary&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">    &lt;h2 class&#x3D;&quot;panel-title&quot;&gt;&#123;&#123;image.title&#125;&#125;&lt;&#x2F;h2&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123;image.description&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;col-md-12 text-center&quot;&gt;</span><br><span class="line">      &lt;img src&#x3D;&quot;&#x2F;public&#x2F;upload&#x2F;&#123;&#123;image.filename&#125;&#125;&quot; alt&#x3D;&quot;&#123;&#123;image.title&#125;&#125;&quot;</span><br><span class="line">        class&#x3D;&quot;thumbnail&quot;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-footer&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-8&quot;&gt;</span><br><span class="line">        &lt;button class&#x3D;&quot;btn btn-success&quot; id&#x3D;&quot;btn-like&quot; data-id&#x3D;&quot;&#123;&#123;image.uniqueId&#125;&#125;&quot;&gt;</span><br><span class="line">          &lt;i class&#x3D;&quot;fa fa-heart&quot;&gt; 点赞&lt;&#x2F;i&gt;</span><br><span class="line">        &lt;&#x2F;button&gt;</span><br><span class="line">        &lt;strong class&#x3D;&quot;likes-count&quot;&gt;&#123;&#123;image.likes&#125;&#125;&lt;&#x2F;strong&gt; &amp;nbsp; - &amp;nbsp;</span><br><span class="line">        &lt;i class&#x3D;&quot;fa fa-eye&quot;&gt;&lt;&#x2F;i&gt;</span><br><span class="line">        &lt;strong&gt;&#123;&#123;image.views&#125;&#125;&lt;&#x2F;strong&gt;</span><br><span class="line">        &amp;nbsp; - &amp;nbsp; 发表于: &lt;em class&#x3D;&quot;text-muted&quot;&gt;&#123;&#123;image.timestamp&#125;&#125;&lt;&#x2F;em&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-right&quot;&gt;</span><br><span class="line">        &lt;button class&#x3D;&quot;btn btn-danger&quot; id&#x3D;&quot;btn-delete&quot; data-id&#x3D;&quot;&#123;&#123;image.uniqueId&#125;&#125;&quot;&gt;</span><br><span class="line">          &lt;i class&#x3D;&quot;fa fa-times&quot;&gt;&lt;&#x2F;i&gt;</span><br><span class="line">        &lt;&#x2F;button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-default&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-8&quot;&gt;</span><br><span class="line">        &lt;strong class&#x3D;&quot;panel-title&quot;&gt;评论&lt;&#x2F;strong&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-right&quot;&gt;</span><br><span class="line">        &lt;button class&#x3D;&quot;btn btn-default btn-sm&quot; id&#x3D;&quot;btn-comment&quot; data-id&#x3D;&quot;&#123;&#123;image.uniqueId&#125;&#125;&quot;&gt;</span><br><span class="line">          &lt;i class&#x3D;&quot;fa fa-comments-o&quot;&gt; 发表评论...&lt;&#x2F;i&gt;</span><br><span class="line">        &lt;&#x2F;button&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">    &lt;blockquote id&#x3D;&quot;post-comment&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">        &lt;form action&#x3D;&quot;&#x2F;images&#x2F;&#123;&#123;image.uniqueId&#125;&#125;&#x2F;comment&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;form-group col-sm-12&quot;&gt;</span><br><span class="line">            &lt;label for&#x3D;&quot;name&quot; class&#x3D;&quot;col-sm-2 control-label&quot;&gt;昵称:&lt;&#x2F;label&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;col-sm-10&quot;&gt;&lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; name&#x3D;&quot;name&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;form-group col-sm-12&quot;&gt;</span><br><span class="line">            &lt;label for&#x3D;&quot;email&quot; class&#x3D;&quot;col-sm-2 control-label&quot;&gt;Email:&lt;&#x2F;label&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;col-sm-10&quot;&gt;&lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; name&#x3D;&quot;email&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;form-group col-sm-12&quot;&gt;</span><br><span class="line">            &lt;label for&#x3D;&quot;comment&quot; class&#x3D;&quot;col-sm-2 control-label&quot;&gt;评论:&lt;&#x2F;label&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;col-sm-10&quot;&gt;</span><br><span class="line">              &lt;textarea name&#x3D;&quot;comment&quot; class&#x3D;&quot;form-control&quot; rows&#x3D;&quot;2&quot;&gt;&lt;&#x2F;textarea&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;form-group col-sm-12&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;col-sm-12 text-right&quot;&gt;</span><br><span class="line">              &lt;button class&#x3D;&quot;btn btn-success&quot; id&#x3D;&quot;comment-btn&quot; type&#x3D;&quot;button&quot;&gt;</span><br><span class="line">                &lt;i class&#x3D;&quot;fa fa-comment&quot;&gt;&lt;&#x2F;i&gt; 发表</span><br><span class="line">              &lt;&#x2F;button&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;blockquote&gt;</span><br><span class="line">    &lt;ul class&#x3D;&quot;media-list&quot;&gt;</span><br><span class="line">      &#123;&#123;#each comments&#125;&#125;</span><br><span class="line">      &lt;li class&#x3D;&quot;media&quot;&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;#&quot; class&#x3D;&quot;pull-left&quot;&gt;</span><br><span class="line">          &lt;img src&#x3D;&quot;http:&#x2F;&#x2F;www.gravatar.com&#x2F;avatar&#x2F;&#123;&#123;gravatar&#125;&#125;?d&#x3D;monsterid&amp;s&#x3D;45&quot;</span><br><span class="line">            class&#x3D;&quot;media-object img-circle&quot;&gt;</span><br><span class="line">        &lt;&#x2F;a&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;media-body&quot;&gt;</span><br><span class="line">          &#123;&#123;comment&#125;&#125;</span><br><span class="line">          &lt;br&#x2F;&gt;</span><br><span class="line">          &lt;strong class&#x3D;&quot;media-heading&quot;&gt;&#123;&#123;name&#125;&#125;&lt;&#x2F;strong&gt;</span><br><span class="line">          &lt;small class&#x3D;&quot;text-muted&quot;&gt;&#123;&#123;timestamp&#125;&#125;&lt;&#x2F;small&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;li&gt;</span><br><span class="line">      &#123;&#123;&#x2F;each&#125;&#125;</span><br><span class="line">    &lt;&#x2F;ul&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>在展示所有评论的代码中，我们同样用到了 handlebars 的循环语法，非常方便。</p><p>然后，我们将分别实现网站右边栏中的统计数据、最受欢迎图片和最新评论组件。</p><p>首先是统计数据组件模板：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; views&#x2F;partials&#x2F;stats.handlebars</span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-default&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">    &lt;h3 class&#x3D;&quot;panel-title&quot;&gt;统计数据&lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-left&quot;&gt;图片:&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-8 text-right&quot;&gt;&#123;&#123;sidebar.stats.images&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-left&quot;&gt;评论:&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-8 text-right&quot;&gt;&#123;&#123;sidebar.stats.comments&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-left&quot;&gt;浏览:&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-8 text-right&quot;&gt;&#123;&#123;sidebar.stats.views&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-left&quot;&gt;点赞:&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-8 text-right&quot;&gt;&#123;&#123;sidebar.stats.likes&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>最受欢迎图片组件（popular.handlebars）:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; views&#x2F;partials&#x2F;popular.handlebars</span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-default&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">    &lt;h3 class&#x3D;&quot;panel-title&quot;&gt;最受欢迎&lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">    &#123;&#123;#each sidebar.popular&#125;&#125;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-4 text-center&quot; style&#x3D;&quot;padding-bottom: .5em;&quot;&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;&#x2F;images&#x2F;&#123;&#123;uniqueId&#125;&#125;&quot;&gt;</span><br><span class="line">          &lt;img src&#x3D;&quot;&#x2F;public&#x2F;upload&#x2F;&#123;&#123;filename&#125;&#125;&quot; style&#x3D;&quot;width: 75px; height: 75px;&quot;</span><br><span class="line">            class&#x3D;&quot;img-thumbnail&quot;&gt;</span><br><span class="line">        &lt;&#x2F;a&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &#123;&#123;&#x2F;each&#125;&#125;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>最新评论组件（comments.handlebars）:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; views&#x2F;partials&#x2F;comments.handlebars</span><br><span class="line">&lt;div class&#x3D;&quot;panel panel-default&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class="line">    &lt;h3 class&#x3D;&quot;panel-title&quot;&gt;最新评论&lt;&#x2F;h3&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class="line">    &lt;ul class&#x3D;&quot;media-list&quot;&gt;</span><br><span class="line">      &#123;&#123;#each sidebar.comments&#125;&#125;</span><br><span class="line">      &lt;li class&#x3D;&quot;media&quot;&gt;</span><br><span class="line">        &lt;a href&#x3D;&quot;&#x2F;images&#x2F;&#123;&#123;image.uniqueId&#125;&#125;&quot; class&#x3D;&quot;pull-left&quot;&gt;</span><br><span class="line">          &lt;img src&#x3D;&quot;&#x2F;public&#x2F;upload&#x2F;&#123;&#123;image.filename&#125;&#125;&quot; class&#x3D;&quot;media-object&quot;</span><br><span class="line">            height&#x3D;&quot;45&quot; width&#x3D;&quot;45&quot;&gt;</span><br><span class="line">        &lt;&#x2F;a&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;media-body&quot;&gt;</span><br><span class="line">          &#123;&#123;comment&#125;&#125;&lt;br&#x2F;&gt;</span><br><span class="line">          &lt;strong class&#x3D;&quot;media-heading&quot;&gt;&#123;&#123;name&#125;&#125;&lt;&#x2F;strong&gt;</span><br><span class="line">          &lt;small class&#x3D;&quot;text-muted&quot;&gt;&#123;&#123;timestamp&#125;&#125;&lt;&#x2F;small&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;li&gt;</span><br><span class="line">      &#123;&#123;&#x2F;each&#125;&#125;</span><br><span class="line">    &lt;&#x2F;ul&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>最后，我们在布局模板 layouts/main.handlebars 中加入所有组件模板，加入模板的语法为 &#123;&#123;&gt; component this&#125;&#125;。除此之外，由于我们用到了一些小图标，所以加上 font-awesome 的链接。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; views&#x2F;layouts&#x2F;main.handlebars</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;title&gt;Instagrammy&lt;&#x2F;title&gt;</span><br><span class="line">  &lt;link href&#x3D;&quot;http:&#x2F;&#x2F;netdna.bootstrapcdn.com&#x2F;bootstrap&#x2F;3.1.1&#x2F;css&#x2F;bootstrap.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line">  &lt;link href&#x3D;&quot;http:&#x2F;&#x2F;netdna.bootstrapcdn.com&#x2F;font-awesome&#x2F;4.0.3&#x2F;css&#x2F;font-awesome.min.css&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;page-header&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-md-6&quot;&gt;</span><br><span class="line">        &lt;h1&gt;&lt;a href&#x3D;&quot;&#x2F;&quot;&gt;Instagrammy&lt;&#x2F;a&gt;&lt;&#x2F;h1&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">  &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;&#123;&#123;&#123;body&#125;&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class="line">        &#123;&#123;&gt; stats this&#125;&#125;</span><br><span class="line">        &#123;&#123;&gt; popular this&#125;&#125;</span><br><span class="line">        &#123;&#123;&gt; comments this&#125;&#125;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><h3 id="将数据传入模板视图"><a href="#将数据传入模板视图" class="headerlink" title="将数据传入模板视图"></a>将数据传入模板视图</h3><p>如果没有数据传入，那么模板相应的数据部分将全都是空白。在这一步中，我们将用一些假数据来演示如何从控制器将数据传入模板视图。</p><p>首先在 home 控制器中构造一个 viewModel 对象，并在 render 函数中作为第二参数传入。可以看到 viewModel 对象与模板中的数据接口是完全一致的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; controllers&#x2F;home.js</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  index: function(req, res) &#123;</span><br><span class="line">    const viewModel &#x3D; &#123;</span><br><span class="line">      images: [</span><br><span class="line">        &#123;</span><br><span class="line">          uniqueId: 1,</span><br><span class="line">          title: &#39;示例图片1&#39;,</span><br><span class="line">          description: &#39;&#39;,</span><br><span class="line">          filename: &#39;sample1.jpg&#39;,</span><br><span class="line">          views: 0,</span><br><span class="line">          likes: 0,</span><br><span class="line">          timestamp: Date.now(),</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          uniqueId: 2,</span><br><span class="line">          title: &#39;示例图片2&#39;,</span><br><span class="line">          description: &#39;&#39;,</span><br><span class="line">          filename: &#39;sample2.jpg&#39;,</span><br><span class="line">          views: 0,</span><br><span class="line">          likes: 0,</span><br><span class="line">          timestamp: Date.now(),</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          uniqueId: 3,</span><br><span class="line">          title: &#39;示例图片3&#39;,</span><br><span class="line">          description: &#39;&#39;,</span><br><span class="line">          filename: &#39;sample3.jpg&#39;,</span><br><span class="line">          views: 0,</span><br><span class="line">          likes: 0,</span><br><span class="line">          timestamp: Date.now(),</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">    res.render(&#39;index&#39;, viewModel);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; controllers&#x2F;image.js</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  index: function(req, res) &#123;</span><br><span class="line">    const viewModel &#x3D; &#123;</span><br><span class="line">      image: &#123;</span><br><span class="line">        uniqueId: 1,</span><br><span class="line">        title: &#39;示例图片1&#39;,</span><br><span class="line">        description: &#39;这是张测试图片&#39;,</span><br><span class="line">        filename: &#39;sample1.jpg&#39;,</span><br><span class="line">        views: 0,</span><br><span class="line">        likes: 0,</span><br><span class="line">        timestamp: Date.now(),</span><br><span class="line">      &#125;,</span><br><span class="line">      comments: [</span><br><span class="line">        &#123;</span><br><span class="line">          image_id: 1,</span><br><span class="line">          email: &#39;test@testing.com&#39;,</span><br><span class="line">          name: &#39;Test Tester&#39;,</span><br><span class="line">          comment: &#39;Test 1&#39;,</span><br><span class="line">          timestamp: Date.now(),</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          image_id: 1,</span><br><span class="line">          email: &#39;test@testing.com&#39;,</span><br><span class="line">          name: &#39;Test Tester&#39;,</span><br><span class="line">          comment: &#39;Test 2&#39;,</span><br><span class="line">          timestamp: Date.now(),</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">    res.render(&#39;image&#39;, viewModel);</span><br><span class="line">  &#125;,</span><br><span class="line">  create: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:create POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">  like: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:like POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">  comment: function(req, res) &#123;</span><br><span class="line">    res.send(&#39;The image:comment POST controller&#39;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在传入数据时，我们可以自定义一些 helper 函数在模板中使用。例如 timestamp 时间戳，Date.now() 返回的是一串数字，显然用户体验很不友好，因此我们需要将其转换为方便用户阅读的时间，例如 “几秒前”“两小时前”。这里我们选用 JavaScript 最流行的处理时间的库 moment.js，并通过 npm 安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i moment</span><br></pre></td></tr></table></figure><p>然后在 server/configure.js 中配置 handlebars 的 helper 函数 timeago：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; server&#x2F;configure.js</span><br><span class="line"></span><br><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const exphbs &#x3D; require(&#39;express-handlebars&#39;);</span><br><span class="line">const express &#x3D; require(&#39;express&#39;);</span><br><span class="line">const bodyParser &#x3D; require(&#39;body-parser&#39;);</span><br><span class="line">const cookieParser &#x3D; require(&#39;cookie-parser&#39;);</span><br><span class="line">const morgan &#x3D; require(&#39;morgan&#39;);</span><br><span class="line">const methodOverride &#x3D; require(&#39;method-override&#39;);</span><br><span class="line">const errorHandler &#x3D; require(&#39;errorhandler&#39;);</span><br><span class="line">const moment &#x3D; require(&#39;moment&#39;);</span><br><span class="line"></span><br><span class="line">const routes &#x3D; require(&#39;.&#x2F;routes&#39;);</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; function(app) &#123;</span><br><span class="line">  &#x2F;&#x2F; 定义 moment 全局语言</span><br><span class="line">  moment.locale(&#39;zh-cn&#39;);</span><br><span class="line"></span><br><span class="line">  app.engine(</span><br><span class="line">    &#39;handlebars&#39;,</span><br><span class="line">    exphbs.create(&#123;</span><br><span class="line">      helpers: &#123;</span><br><span class="line">        timeago: function(timestamp) &#123;</span><br><span class="line">          return moment(timestamp).startOf(&#39;minute&#39;).fromNow();</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;).engine,</span><br><span class="line">  );</span><br><span class="line">  app.set(&#39;view engine&#39;, &#39;handlebars&#39;);</span><br><span class="line"></span><br><span class="line">  app.use(morgan(&#39;dev&#39;));</span><br><span class="line">  app.use(bodyParser.urlencoded(&#123; extended: true &#125;));</span><br><span class="line">  app.use(bodyParser.json());</span><br><span class="line">  app.use(methodOverride());</span><br><span class="line">  app.use(cookieParser(&#39;secret-value&#39;));</span><br><span class="line">  app.use(&#39;&#x2F;public&#x2F;&#39;, express.static(path.join(__dirname, &#39;..&#x2F;public&#39;)));</span><br><span class="line"></span><br><span class="line">  if (app.get(&#39;env&#39;) &#x3D;&#x3D;&#x3D; &#39;development&#39;) &#123;</span><br><span class="line">    app.use(errorHandler());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  routes(app);</span><br><span class="line">  return app;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>接着在相应用到时间戳的地方加入 timeago 函数：</p><p>views/image.handlebars<br><img src="https://img.brookliu.xyz/blog/express%2BmongoDB-1-2.png" alt="timeago1"></p><p><img src="https://img.brookliu.xyz/blog/express%2BmongoDB-1-3.png" alt="timeago2"></p><p>views/partials/comments.handlebars<br><img src="https://img.brookliu.xyz/blog/express%2BmongoDB-1-4.png" alt="timeago3"></p><p>到这里我们实现了项目的视图和控制器完成了第一部分，下一部分我们来接入MongoDB数据库实现图片上传、点赞、删除、评论等功能。</p><p>原文地址<a href="https://tuture.co/2019/10/16/a0531f0/" target="_blank" rel="noopener">图灵社区</a>。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Brookliu</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://brookliu.xyz/2020/10/13/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%B8%80/" title="Express+MongoDB搭建图片分享社区一">https://brookliu.xyz/2020/10/13/Express-MongoDB搭建图片分享社区一/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Node/" rel="tag"><i class="fa fa-tag"></i> # Node</a><a href="/tags/Express/" rel="tag"><i class="fa fa-tag"></i> # Express</a><a href="/tags/MongoDB/" rel="tag"><i class="fa fa-tag"></i> # MongoDB</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/10/09/Hexo%E5%86%99%E4%BD%9C%E6%A0%B7%E5%BC%8F%E7%AE%80%E4%BB%8B/" rel="prev" title="Hexo写作样式简介"><i class="fa fa-chevron-left"></i> Hexo写作样式简介</a></div><div class="post-nav-item"> <a href="/2020/10/14/Express-MongoDB%E6%90%AD%E5%BB%BA%E5%9B%BE%E7%89%87%E5%88%86%E4%BA%AB%E7%A4%BE%E5%8C%BA%E4%BA%8C/" rel="next" title="Express+MongoDB搭建图片分享社区二">Express+MongoDB搭建图片分享社区二<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化项目结构"><span class="nav-number">1.</span> <span class="nav-text">初始化项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置中间件"><span class="nav-number">2.</span> <span class="nav-text">配置中间件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#搭建路由和控制器"><span class="nav-number">3.</span> <span class="nav-text">搭建路由和控制器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置handlebars模板引擎"><span class="nav-number">4.</span> <span class="nav-text">配置handlebars模板引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完善页面代码"><span class="nav-number">5.</span> <span class="nav-text">完善页面代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将数据传入模板视图"><span class="nav-number">6.</span> <span class="nav-text">将数据传入模板视图</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Brookliu" src="/images/logo.png"><p class="site-author-name" itemprop="name">Brookliu</p><div class="site-description" itemprop="description">扶我起来，我还能写</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">64</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">18</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">20</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/liubrook" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;liubrook" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://juejin.im/user/588993964030574" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;588993964030574" rel="noopener" target="_blank"><i class="fa fa-spinner fa-fw"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/lqpf199681" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;lqpf199681" rel="noopener" target="_blank"><i class="fa fa-crossjairs fa-fw"></i> CSDN</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://www.zhangxinxu.com/" title="http:&#x2F;&#x2F;www.zhangxinxu.com&#x2F;" rel="noopener" target="_blank">张鑫旭</a></li><li class="links-of-blogroll-item"> <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a></li><li class="links-of-blogroll-item"> <a href="http://ife.baidu.com/" title="http:&#x2F;&#x2F;ife.baidu.com&#x2F;" rel="noopener" target="_blank">百度前端技术学院</a></li><li class="links-of-blogroll-item"> <a href="http://wf.uisdc.com/cn/" title="http:&#x2F;&#x2F;wf.uisdc.com&#x2F;cn&#x2F;" rel="noopener" target="_blank">google前端开发基础</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright"> &copy; 2019 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-star"></i></span> <span class="author" itemprop="copyrightHolder">by 1024肥宅</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv"></span></span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fb642a4fe3376d3" async="async"></script></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共136.9k字</span></div><div class="weixin-box"><div class="weixin-menu"><div class="weixin-hover"><div class="weixin-description">微信扫一扫，订阅本博客</div></div></div></div><style>#comments .veditor{min-height:10rem;background-image:url(https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200425091751.png);background-size:contain;background-repeat:no-repeat;background-position:right;background-color:rgba(255,255,255,0);resize:none}</style><script>
    //   自定义邮箱审核规则
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('vsubmit')) {
            const email = document.querySelector('input[type=email]');
            const nick = document.querySelector('input[name=nick]');
            const reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if (!email.value || !nick.value || !reg.test(email.value)) {
                const str = `<div class="valert text-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                const vmark = document.querySelector('.vmark');
                vmark.innerHTML = str;
                vmark.style.display = 'block';
                setTimeout(function() {
                    vmark.style.display = 'none';
                    vmark.innerHTML = '';
                }, 2500);
            }
        }
    })
</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz","app_key":"Q0n1AFSDoyYQsw7RI9eC1rfP","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script size="300" alpha="0.6" zindex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="/js/local-search.js"></script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz',
      appKey     : 'Q0n1AFSDoyYQsw7RI9eC1rfP',
      placeholder: "(。・∀・)ノ )",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-CN' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><script type="text/javascript" src="/js/clicklove.js"></script><script async>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script></body></html>