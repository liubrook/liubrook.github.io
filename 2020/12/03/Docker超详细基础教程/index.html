<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png"><link rel="mask-icon" href="/images/logo.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=EB Garamond:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"brookliu.xyz",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"./public/search.xml"}</script><meta property="og:type" content="article"><meta property="og:title" content="Docker超详细基础教程"><meta property="og:url" content="https://brookliu.xyz/2020/12/03/Docker%E8%B6%85%E8%AF%A6%E7%BB%86%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/index.html"><meta property="og:site_name" content="1024肥宅"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.iconscout.com/icon/free/png-256/docker-226091.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/WeChat0b1cfd2d8b177423652671491e2a782e.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/212351606815357_.pic.jpg"><meta property="og:image" content="https://img.brookliu.xyz/blog/WeChate2d93b57f32681a0788a0e1fcfe8e38d.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/WeChat8b096d57960f60e4aef21f90a207ac70.png"><meta property="og:image" content="https://img.brookliu.xyz/blog/WeChat0a324bc68b5609aab348ddcf8a7a1c41.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202103359125.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202135154813.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202135435348.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202150053909.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202151117361.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202152610797.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202152453378.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202153041926.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202161727559.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202161756699.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202162242988.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202162104630.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202165449820.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202165935326.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202224449925.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201203000655114.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201203000749347.png"><meta property="og:image" content="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201203001600023.png"><meta property="article:published_time" content="2020-12-03T02:21:23.000Z"><meta property="article:modified_time" content="2020-12-03T02:22:14.839Z"><meta property="article:author" content="Brookliu"><meta property="article:tag" content="Docker"><meta property="article:tag" content="GitLab"><meta property="article:tag" content="Jenkins"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.iconscout.com/icon/free/png-256/docker-226091.png"><link rel="canonical" href="https://brookliu.xyz/2020/12/03/Docker%E8%B6%85%E8%AF%A6%E7%BB%86%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Docker超详细基础教程 | 1024肥宅</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="1024肥宅" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a href="https://github.com/liubrook" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">1024肥宅</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签<span class="badge">22</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类<span class="badge">18</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档<span class="badge">65</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/liubrook" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://brookliu.xyz/2020/12/03/Docker%E8%B6%85%E8%AF%A6%E7%BB%86%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/logo.png"><meta itemprop="name" content="Brookliu"><meta itemprop="description" content="扶我起来，我还能写"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="1024肥宅"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Docker超详细基础教程</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-12-03 10:21:23 / 修改时间：10:22:14" itemprop="dateCreated datePublished" datetime="2020-12-03T10:21:23+08:00">2020-12-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a></span></span><span id="/2020/12/03/Docker%E8%B6%85%E8%AF%A6%E7%BB%86%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Docker超详细基础教程" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/2020/12/03/Docker%E8%B6%85%E8%AF%A6%E7%BB%86%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020/12/03/Docker%E8%B6%85%E8%AF%A6%E7%BB%86%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="https://cdn.iconscout.com/icon/free/png-256/docker-226091.png" alt="docker"></p><a id="more"></a><h2 id="一-Docker介绍"><a href="#一-Docker介绍" class="headerlink" title="一.Docker介绍"></a>一.Docker介绍</h2><blockquote><p>Docker 是一个开源的应用容器引擎，基于 <a href="https://www.runoob.com/go/go-tutorial.html" target="_blank" rel="noopener">Go 语言</a> 并遵从 Apache2.0 协议开源。</p><p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p><p>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p><p>Docker 从 17.03 版本之后分为 CE（Community Edition: 社区版） 和 EE（Enterprise Edition: 企业版）。</p></blockquote><h2 id="二-Docker的基本操作"><a href="#二-Docker的基本操作" class="headerlink" title="二.Docker的基本操作"></a>二.Docker的基本操作</h2><h3 id="2-1基本准备"><a href="#2-1基本准备" class="headerlink" title="2.1基本准备"></a>2.1基本准备</h3><p>这篇文章中我的运行环境都是在CentOS7中运行。</p><p>配套视频: <a href="https://www.bilibili.com/video/BV1sK4y1s7Cj" target="_blank" rel="noopener">2020 Docker最新超详细版教程通俗易懂</a></p><h3 id="2-2安装Docker"><a href="#2-2安装Docker" class="headerlink" title="2.2安装Docker"></a>2.2安装Docker</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.下载关于Docker的依赖环境</span></span><br><span class="line">yum -y install yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2.设置下载Docker的镜像源</span></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3.安装Docker</span></span><br><span class="line">yum makacache fast</span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4.启动Docker，并设置为开机自动启动，测试</span></span><br><span class="line"><span class="comment"># 启动Docker服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="comment"># 设置开机自动启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><h3 id="2-3-Docker的中央仓库"><a href="#2-3-Docker的中央仓库" class="headerlink" title="2.3 Docker的中央仓库"></a>2.3 Docker的中央仓库</h3><blockquote><ol><li>Docker官方的中央仓库: 这个仓库是镜像最全的，但是下载速度较慢。<br><a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></li><li>国内的镜像网站：网易蜂巢、daoCloud。。。<br><a href="https://c.163yun.com/hub#/home" target="_blank" rel="noopener">https://c.163yun.com/hub#/home</a><br><a href="https://hub.daocloud.io/" target="_blank" rel="noopener">https://hub.daocloud.io/</a> (推荐使用)</li><li>在公司内部会采用私服的方式拉取镜像。(添加配置)</li></ol></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 需要在/etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">"registry-mirrors"</span>: [<span class="string">"https://registry.docker-cn.com"</span>],</span><br><span class="line">	<span class="attr">"insecure-registries"</span>: [<span class="string">"ip:port]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"># ip:port</span></span><br><span class="line"><span class="string">公司私服的ip和port</span></span><br><span class="line"><span class="string"># 重启两个服务</span></span><br><span class="line"><span class="string">systemctl daemon-reload</span></span><br><span class="line"><span class="string">systemctl restart docker</span></span><br></pre></td></tr></table></figure><h3 id="2-4-镜像的操作"><a href="#2-4-镜像的操作" class="headerlink" title="2.4 镜像的操作"></a>2.4 镜像的操作</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 拉取镜像到本地</span></span><br><span class="line">docker pull 镜像名称[:tag]</span><br><span class="line"><span class="comment"># 举个例子 tomcat</span></span><br><span class="line">docker pull daocloud.io/library/tomcat:8.5.15-jre8</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 查看全部本地的镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. 删除本地镜像</span></span><br><span class="line">docker rmi 镜像的标识</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4. 镜像的导入导出(不规范)</span></span><br><span class="line"><span class="comment"># 将本地的镜像导出</span></span><br><span class="line">docker save -o 导出的路径 镜像id</span><br><span class="line"><span class="comment"># 加载本地的镜像文件</span></span><br><span class="line">docker load -i 镜像文件</span><br><span class="line"><span class="comment"># 修改镜像名称</span></span><br><span class="line">docker tag 镜像id 新镜像名称:版本</span><br></pre></td></tr></table></figure><h3 id="2-5-容器的操作"><a href="#2-5-容器的操作" class="headerlink" title="2.5 容器的操作"></a>2.5 容器的操作</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 运行容器</span></span><br><span class="line"><span class="comment"># 简单操作</span></span><br><span class="line">docker run 镜像的标识|镜像名称[tag]</span><br><span class="line"><span class="comment"># 常用的参数</span></span><br><span class="line">docker run -d -p  宿主机端口:容器端口 --name 容器名称 镜像的标识|镜像名称[tag]</span><br><span class="line"><span class="comment"># -d: 代表后台运行容器</span></span><br><span class="line"><span class="comment"># -p: 宿主机端口:容器端口: 为了映射当前Linux的端口和容器的端口</span></span><br><span class="line"><span class="comment"># --name 容器名称: 指定容器的名称</span></span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 查看正在运行的容器</span></span><br><span class="line">docker ps [OPTIONS]</span><br><span class="line"><span class="comment"># OPTIONS说明:</span></span><br><span class="line"><span class="comment"># -a: 代表查看全部的容器，包括没有运行</span></span><br><span class="line"><span class="comment"># -q: 只查看容器的标识</span></span><br><span class="line"><span class="comment"># -f: 根据条件过滤显示的内容</span></span><br><span class="line"><span class="comment"># --format: 指定返回值的模板文件</span></span><br><span class="line"><span class="comment"># -l: 显示最近创建的容器</span></span><br><span class="line"><span class="comment"># -n: 列出最近创建的n个容器</span></span><br><span class="line"><span class="comment"># --no-trunc: 不截断输出</span></span><br><span class="line"><span class="comment"># -s: 显示总的文件大小</span></span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. 查看容器的日志</span></span><br><span class="line">docker logs -f 容器id</span><br><span class="line"><span class="comment"># -f: 可以滚动查看日志的最后几行</span></span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4. 进入到容器内部</span></span><br><span class="line">docker <span class="built_in">exec</span> -it 容器id bash</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5. 删除容器(删除容器前，需要先停止容器)</span></span><br><span class="line">docker stop 容器id</span><br><span class="line"><span class="comment"># 停止指定的容器</span></span><br><span class="line">docker stop $(docker ps -qa)</span><br><span class="line"><span class="comment"># 停止全部容器</span></span><br><span class="line">docker rm 镜像id</span><br><span class="line"><span class="comment"># 删除指定容器</span></span><br><span class="line">docker rm $(docker ps -qa)</span><br><span class="line"><span class="comment"># 删除全部容器</span></span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#6. 启动容器</span></span><br><span class="line">docker start 容器id</span><br></pre></td></tr></table></figure><h2 id="三-Docker应用"><a href="#三-Docker应用" class="headerlink" title="三.Docker应用"></a>三.Docker应用</h2><h3 id="3-1-准备SSM工程"><a href="#3-1-准备SSM工程" class="headerlink" title="3.1 准备SSM工程"></a>3.1 准备SSM工程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># MySQL数据库的连接用户名和密码改变了，修改db.propreties</span><br><span class="line"># 项目重新打包</span><br><span class="line">mvn clean package -DskipTests</span><br><span class="line"># 项目地址</span><br><span class="line">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1F4xTLoOFCMb7rl1VUrBASA  密码: bgjw</span><br></pre></td></tr></table></figure><h3 id="3-2-准备MySQL容器"><a href="#3-2-准备MySQL容器" class="headerlink" title="3.2 准备MySQL容器"></a>3.2 准备MySQL容器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行MySQL容器</span></span><br><span class="line">docker run -d -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=root daocloud.io/library/mysql:5.7.4</span><br></pre></td></tr></table></figure><h3 id="3-3-准备Tomcat容器"><a href="#3-3-准备Tomcat容器" class="headerlink" title="3.3 准备Tomcat容器"></a>3.3 准备Tomcat容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 运行Tomcat容器，在上面容器操作中已经搞定，只需要将SSM项目的war包部署到Tomcat容器内部</span><br><span class="line"># 可以通过命令将宿主机的内容复制到容器内部</span><br><span class="line">docker cp 文件名称 容器id:容器内部路径</span><br><span class="line"># 举个例子</span><br><span class="line">docker cp ssm.war fe:&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps&#x2F;</span><br></pre></td></tr></table></figure><h3 id="3-4数据卷"><a href="#3-4数据卷" class="headerlink" title="3.4数据卷"></a>3.4数据卷</h3><blockquote><p>为了部署SSM的工程，需要使用到cp的命令将宿主机内的ssm.war文件复制到容器内部。</p><p>数据卷：将宿主机的一个目录映射到容器的一个目录中。</p><p>可以在宿主机中操作目录中的内容，那么容器内部映射的文件，也会跟着一起改变。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建数据卷</span></span><br><span class="line">docker volume create 数据卷名称</span><br><span class="line"><span class="comment"># 创建数据卷之后默认会存放在一个目录下 /var/lib/docker/volumes/数据卷名称/_data</span></span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 查看数据卷的详细信息</span></span><br><span class="line">docker volume inspect 数据卷名称</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. 查看全部数据卷</span></span><br><span class="line">docker volume ls</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4. 删除数据卷</span></span><br><span class="line">docker volume rm 数据卷名称</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5. 应用数据卷</span></span><br><span class="line"><span class="comment"># 当你映射数据卷时，如果数据卷不存在。Docker会帮你自动创建</span></span><br><span class="line">docker run -v 数据卷名称:容器内部路径 镜像id</span><br><span class="line"><span class="comment"># 直接指定一个路径作为数据卷的存放位置。这个路径下是空的。</span></span><br><span class="line">docker run -v 路径:容器内部的路径 镜像id</span><br></pre></td></tr></table></figure><h2 id="四-Docker自定义镜像"><a href="#四-Docker自定义镜像" class="headerlink" title="四.Docker自定义镜像"></a>四.Docker自定义镜像</h2><blockquote><p>中央仓库上的镜像，也是Docker的用户自己上传过去的。</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建一个Dockerfile文件，并且指定自定义镜像信息。</span></span><br><span class="line"><span class="comment"># Dockerfile文件中常用的内容</span></span><br><span class="line">from: 指定当前自定义镜像依赖的环境</span><br><span class="line">copy: 将相对路径下的内容复制到自定义镜像中</span><br><span class="line">workdir: 声明镜像的默认工作目录</span><br><span class="line">cmd: 需要执行的命令(在workdir下执行的，cmd可以写多个，只以最后一个为准)</span><br><span class="line"><span class="comment"># 举个例子，自定义一个tomcat镜像，并且将ssm.war部署到tomcat中</span></span><br><span class="line">from daocloud.io/library/tomcat:8.5.15-jre8</span><br><span class="line">copy ssm.war /usr/<span class="built_in">local</span>/tomcat/webapps</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 将准备好的Dockerfile和相应的文件拖拽到Linux操作系统中，通过Docker的命令制作镜像</span></span><br><span class="line">docker build -t 镜像名称:[tag] .</span><br></pre></td></tr></table></figure><h2 id="五-Docker-Compose"><a href="#五-Docker-Compose" class="headerlink" title="五.Docker-Compose"></a>五.Docker-Compose</h2><blockquote><p>之前运行一个镜像，需要添加大量的参数。</p><p>可以通过Docker-Compose编写这些参数。</p><p>Docker-Compose可以帮助我们批量的管理容器。</p><p>只需要通过一个docker-compose.yml文件去维护即可。</p></blockquote><h3 id="5-1-下载Docker-Compose"><a href="#5-1-下载Docker-Compose" class="headerlink" title="5.1 下载Docker-Compose"></a>5.1 下载Docker-Compose</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 去Github官网搜索docker-compose，下载1.24.1版本的Docker-Compose</span></span><br><span class="line">https://github.com/docker/compose/releases/download/1.24.1/docker-compose-Linux-x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将下载好的文件拖拽到Linux系统中</span></span><br><span class="line">将文件上传到你所使用的服务器或者虚拟机，然后将文件移动到/usr/<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 需要将Docker-Compose文件的名称修改一下，基于Docker-Compose文件一个可执行的权限</span></span><br><span class="line">mv docker-compose-Linux-x86_64 docker-compose</span><br><span class="line">chmod 777 docker-compose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 方便后期操作，配置一个环境变量</span></span><br><span class="line"><span class="comment"># 将docker-compose文件移动到了/usr/local/bin，修改了/etc/profile文件，给/usr/local/bin配置到了PATH中</span></span><br><span class="line">mv docker-compose /usr/<span class="built_in">local</span>/bin</span><br><span class="line">vi /etc/profile</span><br><span class="line">	<span class="built_in">export</span> PATH=/usr/<span class="built_in">local</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 测试一下</span></span><br><span class="line"><span class="comment"># 在任意目录下输入docker-compose</span></span><br></pre></td></tr></table></figure><p><img src="https://img.brookliu.xyz/blog/WeChat0b1cfd2d8b177423652671491e2a782e.png" alt="测试结果"></p><h3 id="5-2-Docker-Compose管理MySQL和Tomcat容器"><a href="#5-2-Docker-Compose管理MySQL和Tomcat容器" class="headerlink" title="5.2 Docker-Compose管理MySQL和Tomcat容器"></a>5.2 Docker-Compose管理MySQL和Tomcat容器</h3><blockquote><p>yml文件以key:value方式来指定配置信息</p><p>多个配置信息以换行+缩进的方式来区分</p><p>在docker-compose.yml文件中，不要使用制表符</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span>                     <span class="comment"># 服务的名称</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span>          <span class="comment"># 代表只要Docker启动，那么这个容器就跟着一起启动</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/mysql:5.7.4</span>     <span class="comment"># 指定镜像路径</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span>    <span class="comment"># 指定容器名称</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span>        <span class="comment"># 指定端口号的映射</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">root</span>         <span class="comment"># 指定MySQL的ROOT用户登录密码</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span>                 <span class="comment"># 指定时区</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_mysql-tomcat/mysql_data:/var/lib/mysql</span>        <span class="comment"># 映射数据卷</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span>          <span class="comment"># 代表只要Docker启动，那么这个容器就跟着一起启动</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">daocloud.io/library/tomcat:8.5.15-jre8</span>     <span class="comment"># 指定镜像路径</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">tomcat</span>    <span class="comment"># 指定容器名称</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8080</span><span class="string">:8080</span>        <span class="comment"># 指定端口号的映射</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">root</span>         <span class="comment"># 指定MySQL的ROOT用户登录密码</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span>                 <span class="comment"># 指定时区</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_mysql-tomcat/tomcat_webapps:/usr/local/tomcat/webapps</span>        <span class="comment"># 映射数据卷</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_mysql-tomcat/tomcat_logs:/usr/local/tomcat/logs</span>        <span class="comment"># 映射数据卷</span></span><br></pre></td></tr></table></figure><h3 id="5-3-使用docker-compose命令管理容器"><a href="#5-3-使用docker-compose命令管理容器" class="headerlink" title="5.3 使用docker-compose命令管理容器"></a>5.3 使用docker-compose命令管理容器</h3><blockquote><p>在使用docker-compose的命令时，默认会在当前目录下找docker-compose.yml</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 基于docker-compose.yml启动管理的容器</span></span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. 关闭并删除容器</span></span><br><span class="line">docker-compose down</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. 开启 | 关闭 | 重启已经存在的由docker-compose维护的容器</span></span><br><span class="line">docker-compose start | stop | restart</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 4. 查看由docker-compose管理的容器</span></span><br><span class="line">docker-compose ps</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 5. 查看日志</span></span><br><span class="line">docker-compose logs -f</span><br></pre></td></tr></table></figure><h3 id="5-4-docker-compose配置Dockerfile使用"><a href="#5-4-docker-compose配置Dockerfile使用" class="headerlink" title="5.4 docker-compose配置Dockerfile使用"></a>5.4 docker-compose配置Dockerfile使用</h3><blockquote><p>使用docker-compose.yml文件以及Dockerfile文件在生产自定义镜像的同时启动当前镜像，并且由docker-compose去管理容器</p></blockquote><p><a href="">docker-compose.yml</a></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yml文件</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">ssm:</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">build:</span>          <span class="comment"># 构建自定义镜像</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">../.</span> <span class="comment"># 指定dockerfile文件的所在路径</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span>  <span class="comment"># 指定Dockerfile文件名称</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">ssm:1.0.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ssm</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8081</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br></pre></td></tr></table></figure><hr><p><a href="">Dockerfile文件</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">from daocloud.io&#x2F;library&#x2F;tomcat:8.5.15-jre8</span><br><span class="line">copy ssm.war &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以直接启动基于docker-compose.yml以及Dockerfile文件构建的自定义镜像</span></span><br><span class="line">dockr-compose up -d</span><br><span class="line"><span class="comment"># 如果自定义镜像不存在，会帮助我们构建出自定义镜像，如果自定义镜像已经存在，会直接运行这个自定义镜像</span></span><br><span class="line"><span class="comment"># 重新构建的话</span></span><br><span class="line"><span class="comment"># 重新构建自定义镜像</span></span><br><span class="line">docker-compose build</span><br><span class="line"><span class="comment"># 运行前，重新构建</span></span><br><span class="line">docker-compose up -d --build</span><br></pre></td></tr></table></figure><h2 id="六-Docker-DI、CD"><a href="#六-Docker-DI、CD" class="headerlink" title="六.Docker DI、CD"></a>六.Docker DI、CD</h2><h3 id="6-1-引言"><a href="#6-1-引言" class="headerlink" title="6.1 引言"></a>6.1 引言</h3><blockquote><p>项目部署</p><ol><li><p>将项目通过maven进行编译打包</p><ol start="2"><li>将文件上传到指定的服务器中</li><li>将war包放到tomcat的目录中</li><li>通过Dockerfile将Tomcat和war包转成一个镜像，由DockerCompose去运行容器</li></ol></li></ol><p>项目更新了</p><p>​ 将上述流程再次的从头到尾的执行一次</p></blockquote><h3 id="6-2-CI介绍"><a href="#6-2-CI介绍" class="headerlink" title="6.2 CI介绍"></a>6.2 CI介绍</h3><blockquote><p>CI(continuous intergration)持续集成</p><p>持续集成：编写代码时，完成了一个功能后，立即提交代码到Git仓库中，将项目重新的构建并进行测试。</p><ul><li>快递发现错误。</li><li>防止代码偏离主分支。</li></ul></blockquote><h3 id="6-3-实现持续集成"><a href="#6-3-实现持续集成" class="headerlink" title="6.3 实现持续集成"></a>6.3 实现持续集成</h3><h4 id="6-3-1-搭建Gitlab服务器"><a href="#6-3-1-搭建Gitlab服务器" class="headerlink" title="6.3.1 搭建Gitlab服务器"></a>6.3.1 搭建Gitlab服务器</h4><blockquote><p>1、创建一个全新的虚拟机，并且至少指定4G的运行内存</p></blockquote><blockquote><p>2、安装docker以及docker-compose</p></blockquote><blockquote><p>3、将ssh的默认22端口，修改为60022端口</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">Port 22 -&gt; 60022</span><br><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure><blockquote><p>4、docker-compose.yml文件去安装Gitlab(下载和运行的时间比较长)</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">gitlab:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">'twang2218/gitlab-ce-zh:11.1.4'</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">'gitlab'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">'gitlab'</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">'Asia/Shanghai'</span></span><br><span class="line">      <span class="attr">GITLAB_OMNIBUS_CONFIG:</span> <span class="string">|</span></span><br><span class="line">        <span class="string">external_url</span> <span class="string">'http://192.168.199.110'</span></span><br><span class="line">        <span class="string">gitlab_rails['time_zone']</span> <span class="string">=</span> <span class="string">'Asia/Shanghai'</span></span><br><span class="line">        <span class="string">gitlab_rails['smtp_enable']</span> <span class="string">=</span> <span class="literal">true</span></span><br><span class="line">        <span class="string">gitlab_rails['gitlab_shell_ssh_port']</span> <span class="string">=</span> <span class="number">22</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'22:22'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_gitlab/config:/etc/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_gitlab/data:/var/opt/gitlab</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/docker_gitlab/logs:/var/log/gitlab</span></span><br></pre></td></tr></table></figure><h4 id="6-3-2-搭建Gitlab-Runner"><a href="#6-3-2-搭建Gitlab-Runner" class="headerlink" title="6.3.2 搭建Gitlab-Runner"></a>6.3.2 搭建Gitlab-Runner</h4><blockquote><p>查看资料中的g i t la b-runner文件即可安装</p></blockquote><hr><h4 id="6-3-3-整合项目入门测试"><a href="#6-3-3-整合项目入门测试" class="headerlink" title="6.3.3 整合项目入门测试"></a>6.3.3 整合项目入门测试</h4><blockquote><p>1、创建一个maven工程，添加web.xml文件，编写html页面</p></blockquote><blockquote><p>2、编写gitlab-ci.yml文件</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">  - test</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  stage: test</span><br><span class="line">  script:</span><br><span class="line">    - echo first test ci # 输入的命令</span><br></pre></td></tr></table></figure><blockquote><p>3、将maven工程推送到gitlab中</p></blockquote><blockquote><p>4、可以在gitlab中查看到gitlab-ci.yml编写的内容</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">打开gitlab控制台-左侧CI&#x2F;CD-流水线-已通过</span><br></pre></td></tr></table></figure><p><img src="https://img.brookliu.xyz/blog/212351606815357_.pic.jpg" alt="查看"></p><hr><h4 id="6-3-4编写-gitlab-ci-yml文件"><a href="#6-3-4编写-gitlab-ci-yml文件" class="headerlink" title="6.3.4编写.gitlab-ci.yml文件"></a>6.3.4编写.gitlab-ci.yml文件</h4><blockquote><p>1、编写.gitlab-ci.yml测试命令使用</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">first</span> <span class="string">test</span> <span class="string">ci</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/usr/local/maven/apache-maven-3.6.3/bin/mvn</span> <span class="string">package</span></span><br></pre></td></tr></table></figure><blockquote><p>2、编写关于dockerfile以及dock er-compose.yml文件的具体内容</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. Dockerfile</span></span><br><span class="line">FROM daocloud.io/library/tomcat:8.5.15-jre8</span><br><span class="line">COPY testci.war /usr/<span class="built_in">local</span>/tomcat/webapps</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. docker-compose.yml</span></span><br><span class="line">version: <span class="string">'3.1'</span></span><br><span class="line">services:</span><br><span class="line">  testci:</span><br><span class="line">    build: docker</span><br><span class="line">    restart: always</span><br><span class="line">    container_name: testci</span><br><span class="line">    ports:</span><br><span class="line">    - 8080:8080</span><br></pre></td></tr></table></figure><hr><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3. ci.yml</span></span><br><span class="line">stages:</span><br><span class="line">  - <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>:</span><br><span class="line">  stage: <span class="built_in">test</span></span><br><span class="line">  script:</span><br><span class="line">    - <span class="built_in">echo</span> first <span class="built_in">test</span> ci</span><br><span class="line">    - /usr/<span class="built_in">local</span>/maven/apache-maven-3.6.3/bin/mvn package</span><br><span class="line">    - cp target/testci-1.0-SNAPSHOT.war docker/testci.war</span><br><span class="line">    - docker-compose down</span><br><span class="line">    - docker-compose up -d --build</span><br><span class="line">    - docker rmi $(docker images -qf dangling=<span class="literal">true</span>)</span><br></pre></td></tr></table></figure><blockquote><p>3、测试</p></blockquote><p><img src="https://img.brookliu.xyz/blog/WeChate2d93b57f32681a0788a0e1fcfe8e38d.png" alt="测试图"></p><h3 id="6-4-CD介绍"><a href="#6-4-CD介绍" class="headerlink" title="6.4 CD介绍"></a>6.4 CD介绍</h3><blockquote><p>CD（持续交付，持续部署）</p></blockquote><h3 id="6-5-实现持续交付持续部署"><a href="#6-5-实现持续交付持续部署" class="headerlink" title="6.5 实现持续交付持续部署"></a>6.5 实现持续交付持续部署</h3><h4 id="6-5-1-安装Jenkins"><a href="#6-5-1-安装Jenkins" class="headerlink" title="6.5.1 安装Jenkins"></a>6.5.1 安装Jenkins</h4><blockquote><p>官网：<a href="https://www.jenkins.io/" target="_blank" rel="noopener">https://www.jenkins.io/</a></p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.1'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">jeckins:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">jenkins/jenkins</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">jenkins</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8888</span><span class="string">:8080</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">50000</span><span class="string">:50000</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/var/jenkins_home</span></span><br></pre></td></tr></table></figure><blockquote><p>第一次运行时，会因为data目录没有权限，导致启动失败</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 data</span><br></pre></td></tr></table></figure><blockquote><p>访问<a href="http://192.168.199.109:8888" target="_blank" rel="noopener">http://192.168.199.109:8888</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问速度奇慢无比。。。。</span><br></pre></td></tr></table></figure><blockquote><p>输入密码</p></blockquote><p><img src="https://img.brookliu.xyz/blog/WeChat8b096d57960f60e4aef21f90a207ac70.png" alt="输入密码"></p><blockquote><p>手动指定插件安装：指定下面两个插件即可</p><p>Publish ssh</p><p>git param…</p></blockquote><p>这里安装过程忘了截图了。。。因为服务器安装的太快，没反应过来</p><blockquote><p>安装成功后，需要指定用户名和密码</p></blockquote><p><img src="https://img.brookliu.xyz/blog/WeChat0a324bc68b5609aab348ddcf8a7a1c41.png" alt="jenkins控制台"></p><hr><h4 id="6-5-2-配置目标服务器以及Gitlab免密码登录"><a href="#6-5-2-配置目标服务器以及Gitlab免密码登录" class="headerlink" title="6.5.2 配置目标服务器以及Gitlab免密码登录"></a>6.5.2 配置目标服务器以及Gitlab免密码登录</h4><blockquote><p>Gitlab -&gt; Jenkins -&gt; 目标服务器</p></blockquote><blockquote><p>1、Jenkins去连接目标服务器</p></blockquote><blockquote><p>左侧的系统设置</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202103359125.png" alt="image-20201202103359125"></p><blockquote><p>选中系统设置</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202135154813.png" alt="image-20201202135154813"></p><blockquote><p>搜索Publish over SSH</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202135435348.png" alt="image-20201202135435348"></p><blockquote><p>点击新增</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202150053909.png" alt="image-20201202150053909"></p><hr><h4 id="6-5-3-配置Gitlab免密码登录"><a href="#6-5-3-配置Gitlab免密码登录" class="headerlink" title="6.5.3 配置Gitlab免密码登录"></a>6.5.3 配置Gitlab免密码登录</h4><blockquote><p>1、登录Jenkins容器内部</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it jenkins bash</span><br></pre></td></tr></table></figure><blockquote><p>2、输入生成SSH密钥命令</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;邮箱&quot;</span><br></pre></td></tr></table></figure><blockquote><p>3、将密钥复制到Gitlab的SSH中</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202151117361.png" alt="image-20201202151117361"></p><hr><h4 id="6-5-4-配置JDK和Maven"><a href="#6-5-4-配置JDK和Maven" class="headerlink" title="6.5.4 配置JDK和Maven"></a>6.5.4 配置JDK和Maven</h4><blockquote><p>1、复制本地的jdk和maven的压缩包到data目录下</p></blockquote><blockquote><p>2、手动解压</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202152610797.png" alt="image-20201202152610797"></p><blockquote><p>3、在监控界面中配置JDK和Maven</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202152453378.png" alt="image-20201202152453378"></p><hr><h4 id="6-5-5-手动拉取gitlab项目"><a href="#6-5-5-手动拉取gitlab项目" class="headerlink" title="6.5.5 手动拉取gitlab项目"></a>6.5.5 手动拉取gitlab项目</h4><blockquote><p>使用SSH无密码连接时，第一次连接需要手动确定</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202153041926.png" alt="image-20201202153041926"></p><hr><h4 id="6-5-6-创建maven任务"><a href="#6-5-6-创建maven任务" class="headerlink" title="6.5.6 创建maven任务"></a>6.5.6 创建maven任务</h4><blockquote><p>1、创建maven工程，推送到gitlab</p></blockquote><blockquote><p>2、jenkins的监控页面中创建maven任务</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202161727559.png" alt="image-20201202161727559"></p><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202161756699.png" alt="image-20201202161756699"></p><blockquote><p>3、执行maven任务</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202162242988.png" alt="image-20201202162242988"></p><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202162104630.png" alt="image-20201202162104630"></p><blockquote><p>4、最终效果</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202165449820.png" alt="image-20201202165449820"></p><h3 id="6-6-实现持续交付持续部署"><a href="#6-6-实现持续交付持续部署" class="headerlink" title="6.6 实现持续交付持续部署"></a>6.6 实现持续交付持续部署</h3><blockquote><p>1、安装Git Parameter的插件，Persistent Parameter的插件（版本）</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202165935326.png" alt="image-20201202165935326"></p><blockquote><p>2、重新制定构建项目的方式</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201202224449925.png" alt="image-20201202224449925"></p><hr><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201203000655114.png" alt="image-20201203000655114"></p><blockquote><p>3、构建项目成功后，需要将内容发布到目标服务器</p></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201203000749347.png" alt="image-20201203000749347"></p><blockquote><p>4、修改程序代码，（提交到GitLab仓库中）</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FROM daocloud.io&#x2F;library&#x2F;tomcat:8.5.15-jre8</span><br><span class="line">COPY testcd-1.0-SNAPSHOT.war &#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps</span><br></pre></td></tr></table></figure><hr><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3.1&#39;</span><br><span class="line">services:</span><br><span class="line">  testcd:</span><br><span class="line">    build: docker</span><br><span class="line">    restart: always</span><br><span class="line">    container_name: testcd</span><br><span class="line">    ports:</span><br><span class="line">      - 8081:8080</span><br></pre></td></tr></table></figure><blockquote><p>5、测试</p><ol><li>给当前代码添加一个标签</li><li>到Jenkins中查看</li></ol></blockquote><p><img src="https://gitee.com/wocaishiliufei/blog_img/raw/master/image-20201203001600023.png" alt="image-20201203001600023"></p><blockquote><ol start="3"><li>点击上图的开始构建(查看日志)</li><li>去指定的目标服务器中访问具体服务</li></ol></blockquote></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Brookliu</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://brookliu.xyz/2020/12/03/Docker%E8%B6%85%E8%AF%A6%E7%BB%86%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" title="Docker超详细基础教程">https://brookliu.xyz/2020/12/03/Docker超详细基础教程/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Docker/" rel="tag"><i class="fa fa-tag"></i> # Docker</a><a href="/tags/GitLab/" rel="tag"><i class="fa fa-tag"></i> # GitLab</a><a href="/tags/Jenkins/" rel="tag"><i class="fa fa-tag"></i> # Jenkins</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020/12/02/Typora-Vue%E4%B8%BB%E9%A2%98-Gitee%E5%9B%BE%E5%BA%8A%E8%BD%BB%E6%9D%BE%E5%86%99%E6%96%87%E7%AB%A0/" rel="prev" title="Typora+Vue主题+Gitee图床轻松写文章"><i class="fa fa-chevron-left"></i> Typora+Vue主题+Gitee图床轻松写文章</a></div><div class="post-nav-item"></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一-Docker介绍"><span class="nav-number">1.</span> <span class="nav-text">一.Docker介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二-Docker的基本操作"><span class="nav-number">2.</span> <span class="nav-text">二.Docker的基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1基本准备"><span class="nav-number">2.1.</span> <span class="nav-text">2.1基本准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2安装Docker"><span class="nav-number">2.2.</span> <span class="nav-text">2.2安装Docker</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Docker的中央仓库"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 Docker的中央仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-镜像的操作"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 镜像的操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-容器的操作"><span class="nav-number">2.5.</span> <span class="nav-text">2.5 容器的操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三-Docker应用"><span class="nav-number">3.</span> <span class="nav-text">三.Docker应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-准备SSM工程"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 准备SSM工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-准备MySQL容器"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 准备MySQL容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-准备Tomcat容器"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 准备Tomcat容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4数据卷"><span class="nav-number">3.4.</span> <span class="nav-text">3.4数据卷</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四-Docker自定义镜像"><span class="nav-number">4.</span> <span class="nav-text">四.Docker自定义镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五-Docker-Compose"><span class="nav-number">5.</span> <span class="nav-text">五.Docker-Compose</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-下载Docker-Compose"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 下载Docker-Compose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-Docker-Compose管理MySQL和Tomcat容器"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 Docker-Compose管理MySQL和Tomcat容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-使用docker-compose命令管理容器"><span class="nav-number">5.3.</span> <span class="nav-text">5.3 使用docker-compose命令管理容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-docker-compose配置Dockerfile使用"><span class="nav-number">5.4.</span> <span class="nav-text">5.4 docker-compose配置Dockerfile使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六-Docker-DI、CD"><span class="nav-number">6.</span> <span class="nav-text">六.Docker DI、CD</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-引言"><span class="nav-number">6.1.</span> <span class="nav-text">6.1 引言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-CI介绍"><span class="nav-number">6.2.</span> <span class="nav-text">6.2 CI介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-实现持续集成"><span class="nav-number">6.3.</span> <span class="nav-text">6.3 实现持续集成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-1-搭建Gitlab服务器"><span class="nav-number">6.3.1.</span> <span class="nav-text">6.3.1 搭建Gitlab服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-2-搭建Gitlab-Runner"><span class="nav-number">6.3.2.</span> <span class="nav-text">6.3.2 搭建Gitlab-Runner</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-3-整合项目入门测试"><span class="nav-number">6.3.3.</span> <span class="nav-text">6.3.3 整合项目入门测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-4编写-gitlab-ci-yml文件"><span class="nav-number">6.3.4.</span> <span class="nav-text">6.3.4编写.gitlab-ci.yml文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-CD介绍"><span class="nav-number">6.4.</span> <span class="nav-text">6.4 CD介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5-实现持续交付持续部署"><span class="nav-number">6.5.</span> <span class="nav-text">6.5 实现持续交付持续部署</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-1-安装Jenkins"><span class="nav-number">6.5.1.</span> <span class="nav-text">6.5.1 安装Jenkins</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-2-配置目标服务器以及Gitlab免密码登录"><span class="nav-number">6.5.2.</span> <span class="nav-text">6.5.2 配置目标服务器以及Gitlab免密码登录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-3-配置Gitlab免密码登录"><span class="nav-number">6.5.3.</span> <span class="nav-text">6.5.3 配置Gitlab免密码登录</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-4-配置JDK和Maven"><span class="nav-number">6.5.4.</span> <span class="nav-text">6.5.4 配置JDK和Maven</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-5-手动拉取gitlab项目"><span class="nav-number">6.5.5.</span> <span class="nav-text">6.5.5 手动拉取gitlab项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-5-6-创建maven任务"><span class="nav-number">6.5.6.</span> <span class="nav-text">6.5.6 创建maven任务</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-6-实现持续交付持续部署"><span class="nav-number">6.6.</span> <span class="nav-text">6.6 实现持续交付持续部署</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Brookliu" src="/images/logo.png"><p class="site-author-name" itemprop="name">Brookliu</p><div class="site-description" itemprop="description">扶我起来，我还能写</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">65</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">18</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/liubrook" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;liubrook" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://juejin.im/user/588993964030574" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;588993964030574" rel="noopener" target="_blank"><i class="fa fa-spinner fa-fw"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/lqpf199681" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;lqpf199681" rel="noopener" target="_blank"><i class="fa fa-crossjairs fa-fw"></i> CSDN</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://www.zhangxinxu.com/" title="http:&#x2F;&#x2F;www.zhangxinxu.com&#x2F;" rel="noopener" target="_blank">张鑫旭</a></li><li class="links-of-blogroll-item"> <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a></li><li class="links-of-blogroll-item"> <a href="http://ife.baidu.com/" title="http:&#x2F;&#x2F;ife.baidu.com&#x2F;" rel="noopener" target="_blank">百度前端技术学院</a></li><li class="links-of-blogroll-item"> <a href="http://wf.uisdc.com/cn/" title="http:&#x2F;&#x2F;wf.uisdc.com&#x2F;cn&#x2F;" rel="noopener" target="_blank">google前端开发基础</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright"> &copy; 2019 – <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-star"></i></span> <span class="author" itemprop="copyrightHolder">by 1024肥宅</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv"></span></span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fb642a4fe3376d3" async="async"></script></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共140.5k字</span></div><div class="weixin-box"><div class="weixin-menu"><div class="weixin-hover"><div class="weixin-description">微信扫一扫，订阅本博客</div></div></div></div><style>#comments .veditor{min-height:10rem;background-image:url(https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200425091751.png);background-size:contain;background-repeat:no-repeat;background-position:right;background-color:rgba(255,255,255,0);resize:none}</style><script>
    //   自定义邮箱审核规则
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('vsubmit')) {
            const email = document.querySelector('input[type=email]');
            const nick = document.querySelector('input[name=nick]');
            const reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if (!email.value || !nick.value || !reg.test(email.value)) {
                const str = `<div class="valert text-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                const vmark = document.querySelector('.vmark');
                vmark.innerHTML = str;
                vmark.style.display = 'block';
                setTimeout(function() {
                    vmark.style.display = 'none';
                    vmark.innerHTML = '';
                }, 2500);
            }
        }
    })
</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz","app_key":"Q0n1AFSDoyYQsw7RI9eC1rfP","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script size="300" alpha="0.6" zindex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="/js/local-search.js"></script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz',
      appKey     : 'Q0n1AFSDoyYQsw7RI9eC1rfP',
      placeholder: "(。・∀・)ノ )",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-CN' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><script type="text/javascript" src="/js/clicklove.js"></script><script async>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script></body></html>