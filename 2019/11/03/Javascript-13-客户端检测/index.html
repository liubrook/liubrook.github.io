<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/logo.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/logo.png"><link rel="mask-icon" href="/images/logo.png" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=EB Garamond:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-mac-osx.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"brookliu.xyz",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!0},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"./public/search.xml"}</script><meta name="description" content="浏览器提供商虽然在实现公共接口方面投入了很多精力，但结果仍然是每一种浏览器都有各自的长处，也都有各自的缺点。即使是那些跨平台的浏览器，虽然从技术上看版本相同，也照样存在不一致性问题。因此客户端检测是一种补救措施，不到万不得已就不要使用客户端检测。"><meta property="og:type" content="article"><meta property="og:title" content="Javascript-13-客户端检测"><meta property="og:url" content="https://brookliu.xyz/2019/11/03/Javascript-13-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B/index.html"><meta property="og:site_name" content="1024肥宅"><meta property="og:description" content="浏览器提供商虽然在实现公共接口方面投入了很多精力，但结果仍然是每一种浏览器都有各自的长处，也都有各自的缺点。即使是那些跨平台的浏览器，虽然从技术上看版本相同，也照样存在不一致性问题。因此客户端检测是一种补救措施，不到万不得已就不要使用客户端检测。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-11-03T14:08:24.000Z"><meta property="article:modified_time" content="2020-09-15T09:40:51.000Z"><meta property="article:author" content="Brookliu"><meta property="article:tag" content="JavaScript"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://brookliu.xyz/2019/11/03/Javascript-13-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>Javascript-13-客户端检测 | 1024肥宅</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="1024肥宅" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div> <a href="https://github.com/liubrook" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">1024肥宅</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签<span class="badge">25</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类<span class="badge">19</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档<span class="badge">92</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/liubrook" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://brookliu.xyz/2019/11/03/Javascript-13-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/logo.png"><meta itemprop="name" content="Brookliu"><meta itemprop="description" content="扶我起来，我还能写"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="1024肥宅"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Javascript-13-客户端检测</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-11-03 22:08:24" itemprop="dateCreated datePublished" datetime="2019-11-03T22:08:24+08:00">2019-11-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-09-15 17:40:51" itemprop="dateModified" datetime="2020-09-15T17:40:51+08:00">2020-09-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/JavaScript/" itemprop="url" rel="index"><span itemprop="name">JavaScript</span></a></span></span><span id="/2019/11/03/Javascript-13-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Javascript-13-客户端检测" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span> <span>℃</span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/2019/11/03/Javascript-13-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2019/11/03/Javascript-13-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p>浏览器提供商虽然在实现公共接口方面投入了很多精力，但结果仍然是每一种浏览器都有各自的长处，也都有各自的缺点。即使是那些跨平台的浏览器，虽然从技术上看版本相同，也照样存在不一致性问题。因此客户端检测是一种补救措施，不到万不得已就不要使用客户端检测。</p><a id="more"></a><h3 id="能力检测"><a href="#能力检测" class="headerlink" title="能力检测"></a>能力检测</h3><p>能力检测的目的不是检测浏览器类型，而是检测浏览器是否有该功能。举例来说IE5.0之前的版本不支持document.getElementById()这个DOM方法，但是可以用document.all属性去实现这个功能：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function getElement(id) &#123;</span><br><span class="line">       if (document.getElementById) &#123;</span><br><span class="line">           return document.getElementById(id);</span><br><span class="line">       &#125; else if (document.all) &#123;</span><br><span class="line">           return document.all[id];</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           throw new Error(&quot;No way to retrieve element!&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>使用能力检测有两点要注意：1.把更通用的，性能更佳的方法写在前面。2.必须测试实际用到的特性。不能以为有document.all就认为它是IE而去使用IE拥有的特征。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function getWindowWidth() &#123;</span><br><span class="line">       if (document.all) &#123; &#x2F;&#x2F;假设是IE</span><br><span class="line">           return document.documentElement.clientWidth;&#x2F;&#x2F;错误的用法</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           return window.innerWidth;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="更可靠的能力检测"><a href="#更可靠的能力检测" class="headerlink" title="更可靠的能力检测"></a>更可靠的能力检测</h4><p>使用typeof操作符的确能让检测更加可靠，但是也有例外。在IE8及以前的版本中DOM对象的方法的类型是object而不是function。这是因为DOM对象是宿主对象，IE的早期版本中宿主对象是通过COM而非JScript实现的。因此像document.createElement()函数在IE早期的确是一个COM对象而非function。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;IE8及以前不行</span><br><span class="line">  function hasCreateElement() &#123;</span><br><span class="line">      return typeof document.createElement &#x3D;&#x3D; &quot;function&quot;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>仅IE支持的ActiveX对象与其他对象的差异也很大。例如，不适用typeof检测某个属性会导致错误：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var xhr &#x3D; new ActiveXObject(&quot;Microsoft.XMLHttp&quot;);</span><br><span class="line">    if (xhr.open) &#123; &#x2F;&#x2F;书上说这里会出错，但IE9 xhr.open为undefined</span><br><span class="line">        &#x2F;&#x2F;执行操作</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">function isHostMethod(object, property) &#123;</span><br><span class="line">        var t &#x3D; typeof object[property];</span><br><span class="line">        return t &#x3D;&#x3D; &quot;function&quot; || t &#x3D;&#x3D; &quot;unknown&quot; &#x2F;&#x2F;IE对typeof xhr.open 会返回&quot;unknown&quot;</span><br><span class="line">            || !!(t &#x3D;&#x3D; &quot;object&quot; &amp;&amp; object[property]);&#x2F;&#x2F;是COM对象 且不为null</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="能力检测，不是浏览器检测"><a href="#能力检测，不是浏览器检测" class="headerlink" title="能力检测，不是浏览器检测"></a>能力检测，不是浏览器检测</h4><p>在实际开发中，应该将能力检测作为确定下一步解决方案的依据，而不是用它来判断用户使用的是什么浏览器。下面是两个典型误用和两个正确用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;错误！还不够具体。且后期Safari也实现了相同的属性。</span><br><span class="line">    var isFirefox &#x3D; !!(navigator.vendor &amp;&amp; navigator.vendorSub);</span><br><span class="line">    &#x2F;&#x2F;错误！假设过头了。假设了IE将来版本也会实现这两个属性，且其他浏览器不会实现。</span><br><span class="line">    var isIE &#x3D; !!(document.all &amp;&amp; document.uniqueID);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;确认浏览器是否支持Netscape风格插件</span><br><span class="line">    var hasNSPlugins &#x3D; !!(navigator.plugins &amp;&amp; navigator.plugins.length);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;确定浏览器是否具有DOM1级规定的能力</span><br><span class="line">    var hasDOM1 &#x3D; !!(document.getElementById &amp;&amp; document.createElement &amp;&amp; document.getElementsByTagName);</span><br></pre></td></tr></table></figure><h3 id="怪癖检测"><a href="#怪癖检测" class="headerlink" title="怪癖检测"></a>怪癖检测</h3><p>怪癖检测的目标是识别浏览器的特殊行为。耽于能力检测确认浏览器支持什么能力不同，怪癖检测是想要知道浏览器存在什么缺陷（即bug）。通常要尝试运行一段代码，以确定某一特性不能正常工作。例如在IE8及其早期版本中，如果某个实例属性和原来标记为不可枚举的属性同名，那么该属性就不会出现在for-in循环中。还有Safari3以前版本中会枚举被隐藏的属性。可以通过下面的例子来检测怪癖：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">var hasDontEnumQuirk &#x3D; function()&#123;</span><br><span class="line">       var o &#x3D; &#123; toString : function()&#123;&#125; &#125;;</span><br><span class="line">       for (var prop in o)&#123;</span><br><span class="line">           if (prop &#x3D;&#x3D; &quot;toString&quot;)&#123;</span><br><span class="line">               return false;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       return true;</span><br><span class="line">   &#125;();&#x2F;&#x2F;匿名函数直接执行</span><br><span class="line">   var hasEnumShadowsQuirk &#x3D; function()&#123;</span><br><span class="line">       var o &#x3D; &#123; toString : function()&#123;&#125; &#125;;</span><br><span class="line">       var count &#x3D; 0;</span><br><span class="line">       for (var prop in o)&#123;</span><br><span class="line">           if (prop &#x3D;&#x3D; &quot;toString&quot;)&#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       return (count &gt; 1);</span><br><span class="line">   &#125;();&#x2F;&#x2F;匿名函数直接执行</span><br><span class="line">   alert(hasDontEnumQuirk);</span><br><span class="line">   alert(hasEnumShadowsQuirk);</span><br></pre></td></tr></table></figure><h3 id="用户代理检测"><a href="#用户代理检测" class="headerlink" title="用户代理检测"></a>用户代理检测</h3><p>以下是完整的用户代理字符串检测脚本，包括检测呈现引擎、平台、Windows 操作系统、移动设备和游戏系统。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">var client &#x3D; function()&#123;</span><br><span class="line">	&#x2F;&#x2F;呈现引擎</span><br><span class="line">	var engine &#x3D; &#123;</span><br><span class="line">		ie: 0,</span><br><span class="line">		gecko: 0,</span><br><span class="line">		webkit: 0,</span><br><span class="line">		khtml: 0,</span><br><span class="line">		opera: 0,</span><br><span class="line">		&#x2F;&#x2F;完整的版本号</span><br><span class="line">		ver: null</span><br><span class="line">	&#125;;</span><br><span class="line">	&#x2F;&#x2F;浏览器</span><br><span class="line">	var browser &#x3D; &#123;</span><br><span class="line">		&#x2F;&#x2F;主要浏览器</span><br><span class="line">		ie: 0,</span><br><span class="line">		firefox: 0,</span><br><span class="line">		safari: 0,</span><br><span class="line">		konq: 0,</span><br><span class="line">		opera: 0,</span><br><span class="line">		chrome: 0,</span><br><span class="line">		&#x2F;&#x2F;具体的版本号</span><br><span class="line">		ver: null</span><br><span class="line">	&#125;;</span><br><span class="line">	&#x2F;&#x2F;平台、设备和操作系统</span><br><span class="line">	var system &#x3D; &#123;</span><br><span class="line">		win: false,</span><br><span class="line">		mac: false,</span><br><span class="line">		x11: false,</span><br><span class="line">		&#x2F;&#x2F;移动设备</span><br><span class="line">		iphone: false,</span><br><span class="line">		ipod: false,</span><br><span class="line">		ipad: false,</span><br><span class="line">		ios: false,</span><br><span class="line">		android: false,</span><br><span class="line">		nokiaN: false,</span><br><span class="line">		winMobile: false,</span><br><span class="line">		&#x2F;&#x2F;游戏系统</span><br><span class="line">		wii: false,</span><br><span class="line">		ps: false</span><br><span class="line">	&#125;;</span><br><span class="line">	&#x2F;&#x2F;检测呈现引擎和浏览器</span><br><span class="line">	var ua &#x3D; navigator.userAgent;</span><br><span class="line">	if (window.opera)&#123;</span><br><span class="line">		engine.ver &#x3D; browser.ver &#x3D; window.opera.version();</span><br><span class="line">		engine.opera &#x3D; browser.opera &#x3D; parseFloat(engine.ver);</span><br><span class="line">	&#125; else if (&#x2F;AppleWebKit\&#x2F;(\S+)&#x2F;.test(ua))&#123;</span><br><span class="line">		engine.ver &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">		engine.webkit &#x3D; parseFloat(engine.ver);</span><br><span class="line">		&#x2F;&#x2F;确定是Chrome 还是Safari</span><br><span class="line">		if (&#x2F;Chrome\&#x2F;(\S+)&#x2F;.test(ua))&#123;</span><br><span class="line">			browser.ver &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">			browser.chrome &#x3D; parseFloat(browser.ver);</span><br><span class="line">		&#125; else if (&#x2F;Version\&#x2F;(\S+)&#x2F;.test(ua))&#123;</span><br><span class="line">			browser.ver &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">			browser.safari &#x3D; parseFloat(browser.ver);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			&#x2F;&#x2F;近似地确定版本号</span><br><span class="line">			var safariVersion &#x3D; 1;</span><br><span class="line">			if (engine.webkit &lt; 100)&#123;</span><br><span class="line">				safariVersion &#x3D; 1;</span><br><span class="line">			&#125; else if (engine.webkit &lt; 312)&#123;</span><br><span class="line">				safariVersion &#x3D; 1.2;</span><br><span class="line">			&#125; else if (engine.webkit &lt; 412)&#123;</span><br><span class="line">				safariVersion &#x3D; 1.3;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				safariVersion &#x3D; 2;</span><br><span class="line">			&#125;</span><br><span class="line">			browser.safari &#x3D; browser.ver &#x3D; safariVersion;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else if (&#x2F;KHTML\&#x2F;(\S+)&#x2F;.test(ua) || &#x2F;Konqueror\&#x2F;([^;]+)&#x2F;.test(ua))&#123;</span><br><span class="line">		engine.ver &#x3D; browser.ver &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">		engine.khtml &#x3D; browser.konq &#x3D; parseFloat(engine.ver);</span><br><span class="line">	&#125; else if (&#x2F;rv:([^\)]+)\) Gecko\&#x2F;\d&#123;8&#125;&#x2F;.test(ua))&#123;</span><br><span class="line">		engine.ver &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">		engine.gecko &#x3D; parseFloat(engine.ver);</span><br><span class="line">		&#x2F;&#x2F;确定是不是Firefox</span><br><span class="line">		if (&#x2F;Firefox\&#x2F;(\S+)&#x2F;.test(ua))&#123;</span><br><span class="line">			browser.ver &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">			browser.firefox &#x3D; parseFloat(browser.ver);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else if (&#x2F;MSIE ([^;]+)&#x2F;.test(ua))&#123;</span><br><span class="line">		engine.ver &#x3D; browser.ver &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">		engine.ie &#x3D; browser.ie &#x3D; parseFloat(engine.ver);</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;检测浏览器</span><br><span class="line">	browser.ie &#x3D; engine.ie;</span><br><span class="line">	browser.opera &#x3D; engine.opera;</span><br><span class="line">	&#x2F;&#x2F;检测平台</span><br><span class="line">	var p &#x3D; navigator.platform;</span><br><span class="line">	system.win &#x3D; p.indexOf(&quot;Win&quot;) &#x3D;&#x3D; 0;</span><br><span class="line">	system.mac &#x3D; p.indexOf(&quot;Mac&quot;) &#x3D;&#x3D; 0;</span><br><span class="line">	system.x11 &#x3D; (p &#x3D;&#x3D; &quot;X11&quot;) || (p.indexOf(&quot;Linux&quot;) &#x3D;&#x3D; 0);</span><br><span class="line">	&#x2F;&#x2F;检测Windows 操作系统</span><br><span class="line">	if (system.win)&#123;</span><br><span class="line">		if (&#x2F;Win(?:dows )?([^do]&#123;2&#125;)\s?(\d+\.\d+)?&#x2F;.test(ua))&#123;</span><br><span class="line">			if (RegExp[&quot;$1&quot;] &#x3D;&#x3D; &quot;NT&quot;)&#123;</span><br><span class="line">				switch(RegExp[&quot;$2&quot;])&#123;</span><br><span class="line">					case &quot;5.0&quot;:</span><br><span class="line">						system.win &#x3D; &quot;2000&quot;;</span><br><span class="line">						break;</span><br><span class="line">					case &quot;5.1&quot;:</span><br><span class="line">						system.win &#x3D; &quot;XP&quot;;</span><br><span class="line">						break;</span><br><span class="line">					case &quot;6.0&quot;:</span><br><span class="line">						system.win &#x3D; &quot;Vista&quot;;</span><br><span class="line">						break;</span><br><span class="line">					case &quot;6.1&quot;:</span><br><span class="line">						system.win &#x3D; &quot;7&quot;;</span><br><span class="line">						break;</span><br><span class="line">					default:</span><br><span class="line">						system.win &#x3D; &quot;NT&quot;;</span><br><span class="line">						break;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; else if (RegExp[&quot;$1&quot;] &#x3D;&#x3D; &quot;9x&quot;)&#123;</span><br><span class="line">				system.win &#x3D; &quot;ME&quot;;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				system.win &#x3D; RegExp[&quot;$1&quot;];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;移动设备</span><br><span class="line">	system.iphone &#x3D; ua.indexOf(&quot;iPhone&quot;) &gt; -1;</span><br><span class="line">	system.ipod &#x3D; ua.indexOf(&quot;iPod&quot;) &gt; -1;</span><br><span class="line">	system.ipad &#x3D; ua.indexOf(&quot;iPad&quot;) &gt; -1;</span><br><span class="line">	system.nokiaN &#x3D; ua.indexOf(&quot;NokiaN&quot;) &gt; -1;</span><br><span class="line">	&#x2F;&#x2F;windows mobile</span><br><span class="line">	if (system.win &#x3D;&#x3D; &quot;CE&quot;)&#123;</span><br><span class="line">		system.winMobile &#x3D; system.win;</span><br><span class="line">	&#125; else if (system.win &#x3D;&#x3D; &quot;Ph&quot;)&#123;</span><br><span class="line">		if(&#x2F;Windows Phone OS (\d+.\d+)&#x2F;.test(ua))&#123;;</span><br><span class="line">			system.win &#x3D; &quot;Phone&quot;;</span><br><span class="line">			system.winMobile &#x3D; parseFloat(RegExp[&quot;$1&quot;]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;检测iOS 版本</span><br><span class="line">	if (system.mac &amp;&amp; ua.indexOf(&quot;Mobile&quot;) &gt; -1)&#123;</span><br><span class="line">		if (&#x2F;CPU (?:iPhone )?OS (\d+_\d+)&#x2F;.test(ua))&#123;</span><br><span class="line">			system.ios &#x3D; parseFloat(RegExp.$1.replace(&quot;_&quot;, &quot;.&quot;));</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			system.ios &#x3D; 2; &#x2F;&#x2F;不能真正检测出来，所以只能猜测</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;检测Android 版本</span><br><span class="line">	if (&#x2F;Android (\d+\.\d+)&#x2F;.test(ua))&#123;</span><br><span class="line">		system.android &#x3D; parseFloat(RegExp.$1);</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;游戏系统</span><br><span class="line">	system.wii &#x3D; ua.indexOf(&quot;Wii&quot;) &gt; -1;</span><br><span class="line">	system.ps &#x3D; &#x2F;playstation&#x2F;i.test(ua);</span><br><span class="line">	&#x2F;&#x2F;返回这些对象</span><br><span class="line">	return &#123;</span><br><span class="line">		engine: engine,</span><br><span class="line">		browser: browser,</span><br><span class="line">		system: system</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> Brookliu</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://brookliu.xyz/2019/11/03/Javascript-13-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A3%80%E6%B5%8B/" title="Javascript-13-客户端检测">https://brookliu.xyz/2019/11/03/Javascript-13-客户端检测/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/JavaScript/" rel="tag"><i class="fa fa-tag"></i> # JavaScript</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2019/11/02/Javascript-12-BOM-2/" rel="prev" title="Javascript-12-BOM-2"><i class="fa fa-chevron-left"></i> Javascript-12-BOM-2</a></div><div class="post-nav-item"> <a href="/2019/11/07/Javascript-14-DOM-1/" rel="next" title="Javascript-14-DOM-1">Javascript-14-DOM-1<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#能力检测"><span class="nav-number">1.</span> <span class="nav-text">能力检测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#更可靠的能力检测"><span class="nav-number">1.1.</span> <span class="nav-text">更可靠的能力检测</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#能力检测，不是浏览器检测"><span class="nav-number">1.2.</span> <span class="nav-text">能力检测，不是浏览器检测</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#怪癖检测"><span class="nav-number">2.</span> <span class="nav-text">怪癖检测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户代理检测"><span class="nav-number">3.</span> <span class="nav-text">用户代理检测</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Brookliu" src="/images/logo.png"><p class="site-author-name" itemprop="name">Brookliu</p><div class="site-description" itemprop="description">扶我起来，我还能写</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">92</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/liubrook" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;liubrook" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://juejin.im/user/588993964030574" title="掘金 → https:&#x2F;&#x2F;juejin.im&#x2F;user&#x2F;588993964030574" rel="noopener" target="_blank"><i class="fa fa-spinner fa-fw"></i> 掘金</a></span><span class="links-of-author-item"><a href="https://blog.csdn.net/lqpf199681" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;lqpf199681" rel="noopener" target="_blank"><i class="fa fa-crossjairs fa-fw"></i> CSDN</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://www.zhangxinxu.com/" title="http:&#x2F;&#x2F;www.zhangxinxu.com&#x2F;" rel="noopener" target="_blank">张鑫旭</a></li><li class="links-of-blogroll-item"> <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a></li><li class="links-of-blogroll-item"> <a href="http://ife.baidu.com/" title="http:&#x2F;&#x2F;ife.baidu.com&#x2F;" rel="noopener" target="_blank">百度前端技术学院</a></li><li class="links-of-blogroll-item"> <a href="http://wf.uisdc.com/cn/" title="http:&#x2F;&#x2F;wf.uisdc.com&#x2F;cn&#x2F;" rel="noopener" target="_blank">google前端开发基础</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright"> &copy; 2019 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-star"></i></span> <span class="author" itemprop="copyrightHolder">by 1024肥宅</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv"></span></span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5fb642a4fe3376d3" async="async"></script></div><div class="theme-info"><div class="powered-by"></div> <span class="post-count">博客全站共163.7k字</span></div><div class="weixin-box"><div class="weixin-menu"><div class="weixin-hover"><div class="weixin-description">微信扫一扫，订阅本博客</div></div></div></div><style>#comments .veditor{min-height:10rem;background-image:url(https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200425091751.png);background-size:contain;background-repeat:no-repeat;background-position:right;background-color:rgba(255,255,255,0);resize:none}</style><script>
    //   自定义邮箱审核规则
    document.body.addEventListener('click', function(e) {
        if (e.target.classList.contains('vsubmit')) {
            const email = document.querySelector('input[type=email]');
            const nick = document.querySelector('input[name=nick]');
            const reg = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
            if (!email.value || !nick.value || !reg.test(email.value)) {
                const str = `<div class="valert text-center"><div class="vtext">请填写正确的昵称和邮箱！</div></div>`;
                const vmark = document.querySelector('.vmark');
                vmark.innerHTML = str;
                vmark.style.display = 'block';
                setTimeout(function() {
                    vmark.style.display = 'none';
                    vmark.innerHTML = '';
                }, 2500);
            }
        }
    })
</script><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz","app_key":"Q0n1AFSDoyYQsw7RI9eC1rfP","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script size="300" alpha="0.6" zindex="-1" src="//cdn.jsdelivr.net/gh/theme-next/theme-next-canvas-ribbon@1/canvas-ribbon.js"></script><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var o,n,e=document.getElementsByTagName("link");if(0<e.length)for(i=0;i<e.length;i++)"canonical"==e[i].rel.toLowerCase()&&e[i].href&&(o=e[i].href);n=o?o.split(":")[0]:window.location.protocol.split(":")[0],o||(o=window.location.href),function(){var e=o,i=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(e)){var t="https"===String(n).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";i?(t+="?r="+encodeURIComponent(document.referrer),e&&(t+="&l="+e)):e&&(t+="?l="+e),(new Image).src=t}}(window)}()</script><script src="/js/local-search.js"></script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'wdEmjy5T77AkIgiwj3VfoTD0-gzGzoHsz',
      appKey     : 'Q0n1AFSDoyYQsw7RI9eC1rfP',
      placeholder: "(。・∀・)ノ )",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-CN' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script><script type="text/javascript" src="/js/clicklove.js"></script><script async>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>